<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta
      name="description"
      content="Explore detailed information about our top-quality products. Buy online with secure checkout and fast delivery at Pesco."
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Product Details - Buy Quality Products Online | Pesco</title>
    <!-- <link
      rel="shortcut icon"
      href="assets/images/favicon.png"
      type="image/png"
    /> -->
    <!-- <link
      href="https://fonts.googleapis.com/css2?family=Aoboshi+One&family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
      rel="stylesheet"
    /> -->
    <!-- <link rel="stylesheet" href="assets/fonts/flaticon/flaticon_pesco.css" /> -->
    <link rel="stylesheet" href="assets/fonts/fontawesome/css/all.min.css" />
    <!-- <link
      rel="stylesheet"
      href="assets/vendor/bootstrap/css/bootstrap.min.css"
    /> -->
    <link rel="stylesheet" href="assets/vendor/slick/slick.css" />
    <link
      rel="stylesheet"
      href="assets/vendor/nice-select/css/nice-select.css"
    />
    <!-- <link
      rel="stylesheet"
      href="assets/vendor/magnific-popup/dist/magnific-popup.css"
    /> -->
    <!-- <link rel="stylesheet" href="assets/vendor/jquery-ui/jquery-ui.min.css" /> -->
    <link rel="stylesheet" href="assets/vendor/aos/aos.css" />
    <link rel="stylesheet" href="assets/css/default.css" />
    <link rel="stylesheet" href="assets/css/style.css" />

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document
          .querySelectorAll("a[href$='.html']:not(.lang-btn)")
          .forEach((a) => {
            const href = a.getAttribute("href");
            const page = href.replace(/\.html$/, "");
            if (page === "index" || page === "") {
              a.setAttribute("href", "http://localhost:5173/");
            } else {
              a.setAttribute("href", `http://localhost:5173/${page}`);
            }
            a.addEventListener("click", (e) => {
              e.preventDefault();
              if (page === "index" || page === "") {
                window.parent.location.href = "http://localhost:5173/";
              } else {
                window.parent.location.href = `http://localhost:5173/${page}`;
              }
            });
          });
        document.querySelectorAll('a[href="#"]').forEach((a) => {
          a.addEventListener("click", (e) => e.preventDefault());
        });
      });
    </script>
  </head>

  <style>
    .slider-details img {
      width: 646px !important;
      height: 587px !important;
    }

    .product-meta ul li,
    .product-meta ul li span,
    .product-meta ul li a {
      color: #333 !important;
    }

    .product-thumbnail .cart-button {
      opacity: 0;
      transition: opacity 0.3s;
    }

    .product-thumbnail:hover .cart-button {
      opacity: 1;
    }

    .rating-stars li i {
      color: black;
      font-size: 15px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .rating-stars li.filled i {
      color: #cc0d39;
    }

    #review-success-banner {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
  </style>

  <body>
    <div class="sidemenu-wrapper-cart">
      <div class="sidemenu-content">
        <div class="widget widget-shopping-cart">
          <h4>My cart</h4>
          <div class="sidemenu-cart-close"><i class="far fa-times"></i></div>
          <div class="widget-shopping-cart-content">
            <ul class="pesco-mini-cart-list"></ul>
            <div class="cart-mini-total">
              <div class="cart-total">
                <span><strong>Subtotal:</strong></span>
                <span class="amount"
                  >1 × <span><span class="currency">$</span>00.00</span></span
                >
              </div>
            </div>
            <div class="cart-button-box">
              <a href="checkout.html" class="theme-btn style-one"
                >Proceed to checkout</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <header class="header-area">
      <div class="search-header-main">
        <div class="container">
          <div class="search-header-inner">
            <div class="site-branding">
              <a href="index.html" class="brand-logo">
                <img
                  src="assets/images/logo/logo-main.png"
                  alt="Logo"
                  width="236"
                  height="54"
                  style="width: 157px; height: auto; display: block"
                  loading="lazy"
                />
              </a>
            </div>

            <div class="product-search-category">
              <form action="#" role="search" aria-label="Product Search">
                <label for="search-category" class="visually-hidden"
                  >Select Category</label
                >
                <select id="search-category" class="wide">
                  <option>All Categories</option>
                  <option>Man Shirts</option>
                  <option>Denim Jeans</option>
                  <option>Casual Suit</option>
                  <option>Summer Dress</option>
                  <option>Sweaters</option>
                  <option>Jackets</option>
                </select>

                <div class="form-group">
                  <label for="search-products" class="visually-hidden"
                    >Search Products</label
                  >
                  <input
                    id="search-products"
                    type="text"
                    placeholder="Enter Search Products"
                    required
                    size="30"
                  />

                  <button
                    class="search-btn"
                    type="submit"
                    aria-label="Search"
                    style="min-width: 48px; min-height: 48px"
                  >
                    <i class="far fa-search" aria-hidden="true"></i>
                    <span class="visually-hidden">Search</span>
                  </button>
                </div>
              </form>
            </div>
            <div class="hotline-support item-rtl">
              <div class="icon">
                <i class="flaticon-support"></i>
              </div>
              <div class="info">
                <span>24/7 Support</span>
                <h5><a href="tel:+941234567894">+94 123 4567 894</a></h5>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="header-navigation style-one">
        <div class="container">
          <div class="primary-menu">
            <div class="site-branding d-lg-none d-block">
              <a href="index.html" class="brand-logo">
                <img
                  src="assets/images/logo/logo-main.png"
                  alt="Logo"
                  width="236"
                  height="54"
                  style="width: 157px; height: auto; display: block"
                  loading="lazy"
                />
              </a>
            </div>

            <div class="nav-inner-menu">
              <div class="main-categories-wrap d-none d-lg-block">
                <a class="categories-btn-active" href="/shops">
                  <span class="fas fa-list"></span
                  ><span class="text"
                    >Products Category<i class="fas fa-angle-down"></i
                  ></span>
                </a>
                <div
                  class="categories-dropdown-wrap categories-dropdown-active"
                >
                  <div class="categori-dropdown-item">
                    <ul>
                      <li>
                        <a href="shops.html">
                          <img
                            src="assets/images/icon/shirt.png"
                            alt="Shirts"
                            loading="lazy"
                          />Man Shirts</a
                        >
                      </li>
                      <li>
                        <a href="shops.html">
                          <img
                            src="assets/images/icon/denim.png"
                            alt="Jeans"
                            loading="lazy"
                          />Denim Jeans</a
                        >
                      </li>
                      <li>
                        <a href="shops.html">
                          <img
                            src="assets/images/icon/suit.png"
                            alt="Suit"
                            loading="lazy"
                          />Casual Suit</a
                        >
                      </li>
                      <li>
                        <a href="shops.html">
                          <img
                            src="assets/images/icon/dress.png"
                            alt="Dress"
                            loading="lazy"
                          />Summer Dress</a
                        >
                      </li>
                      <li>
                        <a href="shops.html">
                          <img
                            src="assets/images/icon/sweaters.png"
                            alt="Sweaters"
                            loading="lazy"
                          />Sweaters</a
                        >
                      </li>
                    </ul>
                  </div>
                  <div class="more_slide_open">
                    <div class="categori-dropdown-item">
                      <ul>
                        <li>
                          <a href="shops.html"
                            ><img
                              src="assets/images/icon/jacket.png"
                              alt="Jackets"
                              loading="lazy"
                            />Jackets</a
                          >
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="more_categories">
                    <span class="icon"></span> <span>Show more...</span>
                  </div>
                </div>
              </div>
              <div class="pesco-nav-main">
                <div class="pesco-nav-menu">
                  <div class="nav-search mb-40 d-block d-lg-none">
                    <div class="form-group">
                      <input
                        type="search"
                        class="form_control"
                        placeholder="Search Here"
                        required
                      />
                      <button class="search-btn" type="button">
                        <i class="far fa-search" aria-hidden="true"></i>
                        <span class="visually-hidden">Search</span>
                      </button>
                    </div>
                  </div>
                  <div class="pesco-tabs style-three d-block d-lg-none">
                    <ul class="nav nav-tabs mb-30">
                      <li>
                        <button
                          class="nav-link active"
                          data-bs-toggle="tab"
                          data-bs-target="#nav1"
                        >
                          Menu
                        </button>
                      </li>
                      <li>
                        <button
                          class="nav-link"
                          data-bs-toggle="tab"
                          data-bs-target="#nav2"
                        >
                          Category
                        </button>
                      </li>
                    </ul>
                    <div class="tab-content">
                      <div class="tab-pane fade show active" id="nav1">
                        <nav class="main-menu">
                          <ul>
                            <li class="menu-item has-children">
                              <a href="index.html">Home</a>
                              <ul class="sub-menu">
                                <li><a href="index.html">Home 01</a></li>
                                <li><a href="index-2.html">Home 02</a></li>
                              </ul>
                            </li>
                            <li class="menu-item has-children">
                              <a href="/shops-grid">Shop</a>
                              <ul class="sub-menu">
                                <li><a href="shops-grid.html">Shop Grid</a></li>
                                <li>
                                  <a href="shops.html">Shop left Sidebar</a>
                                </li>
                                <li>
                                  <a href="shops-right-sidebar.html"
                                    >Shop Right Sidebar</a
                                  >
                                </li>
                                <li>
                                  <a href="shop-details.html"
                                    >Product Details</a
                                  >
                                </li>
                                <li><a href="cart.html">Cart</a></li>
                                <li><a href="checkout.html">Checkout</a></li>
                                <li><a href="wishlists.html">Wishlist</a></li>
                              </ul>
                            </li>
                            <li class="menu-item has-children">
                              <a href="blogs.html">Blog</a>
                              <ul class="sub-menu">
                                <li><a href="blogs.html">Our Blog</a></li>
                                <li>
                                  <a href="blog-details.html">Blog Details</a>
                                </li>
                              </ul>
                            </li>
                            <li class="menu-item has-children">
                              <a href="/about-us">Pages</a>
                              <ul class="sub-menu">
                                <li><a href="about-us.html">About Us</a></li>
                                <li><a href="faq.html">Faqs</a></li>
                              </ul>
                            </li>
                            <li class="menu-item">
                              <a href="contact.html">Contact</a>
                            </li>
                          </ul>
                        </nav>
                      </div>
                      <div class="tab-pane fade" id="nav2">
                        <div class="categori-dropdown-item">
                          <ul>
                            <li>
                              <a href="shops.html">
                                <img
                                  src="assets/images/icon/shirt.png"
                                  alt="Shirts"
                                  loading="lazy"
                                />Man Shirts</a
                              >
                            </li>
                            <li>
                              <a href="shops.html">
                                <img
                                  src="assets/images/icon/denim.png"
                                  alt="Jeans"
                                  loading="lazy"
                                />Denim Jeans</a
                              >
                            </li>
                            <li>
                              <a href="shops.html">
                                <img
                                  src="assets/images/icon/suit.png"
                                  alt="Suit"
                                  loading="lazy"
                                />Casual Suit</a
                              >
                            </li>
                            <li>
                              <a href="shops.html">
                                <img
                                  src="assets/images/icon/dress.png"
                                  alt="Dress"
                                  loading="lazy"
                                />Summer Dress</a
                              >
                            </li>
                            <li>
                              <a href="shops.html">
                                <img
                                  src="assets/images/icon/sweaters.png"
                                  alt="Sweaters"
                                  loading="lazy"
                                />Sweaters</a
                              >
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="hotline-support d-flex d-lg-none mt-30">
                    <div class="icon">
                      <i class="flaticon-support"></i>
                    </div>
                    <div class="info">
                      <span>24/7 Support</span>
                      <h5><a href="tel:+941234567894">+94 123 4567 894</a></h5>
                    </div>
                  </div>
                  <nav class="main-menu d-none d-lg-block">
                    <ul>
                      <li class="menu-item has-children">
                        <a href="index.html">Home</a>
                        <ul class="sub-menu">
                          <li><a href="index.html">Home 01</a></li>
                          <li><a href="index-2.html">Home 02</a></li>
                        </ul>
                      </li>
                      <li class="menu-item has-children">
                        <a href="/shops-grid">Shop</a>
                        <ul class="sub-menu">
                          <li><a href="shops-grid.html">Shop Grid</a></li>
                          <li><a href="shops.html">Shop left Sidebar</a></li>
                          <li>
                            <a href="shops-right-sidebar.html"
                              >Shop Right Sidebar</a
                            >
                          </li>
                          <li>
                            <a href="shop-details.html">Product Details</a>
                          </li>
                          <li><a href="cart.html">Cart</a></li>
                          <li><a href="checkout.html">Checkout</a></li>
                          <li><a href="wishlists.html">Wishlist</a></li>
                        </ul>
                      </li>
                      <li class="menu-item has-children">
                        <a href="/blogs">Blog</a>
                        <ul class="sub-menu">
                          <li><a href="blogs.html">Our Blog</a></li>
                          <li><a href="blog-details.html">Blog Details</a></li>
                        </ul>
                      </li>
                      <li class="menu-item has-children">
                        <a href="/about-us">Pages</a>
                        <ul class="sub-menu">
                          <li><a href="about-us.html">About Us</a></li>
                          <li><a href="faq.html">Faqs</a></li>
                        </ul>
                      </li>
                      <li class="menu-item">
                        <a href="contact.html">Contact</a>
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
            <div class="nav-right-item style-one">
              <ul>
                <li>
                  <div class="deals d-lg-block d-none">
                    <i class="far fa-fire-alt"></i>
                    <span class="visually-hidden">Deal</span>
                  </div>
                </li>
                <li>
                  <a href="wishlists.html" aria-label="View Wishlist">
                    <div class="wishlist-btn d-lg-block d-none">
                      <i class="far fa-heart" aria-hidden="true"></i>
                      <span class="pro-count" id="pro-counts1">00</span>
                      <span class="visually-hidden">Wishlist</span>
                    </div>
                  </a>
                </li>

                <li>
                  <div class="cart-button d-flex align-items-center">
                    <a href="cart.html" aria-label="View Cart">
                      <div class="icon">
                        <i class="fas fa-shopping-bag" aria-hidden="true"></i>
                        <span class="pro-count" id="pro-counts">00</span>
                        <span class="visually-hidden">Cart</span>
                      </div>
                    </a>
                  </div>
                </li>
              </ul>
              <div class="navbar-toggler d-block d-lg-none">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="main-bg">
      <section class="page-banner">
        <div class="page-banner-wrapper p-r z-1">
          <svg
            class="lineanm"
            viewBox="0 0 1920 347"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              class="line"
              d="M-39 345.187C70 308.353 397.628 293.477 436 145.186C490 -63.5 572 -57.8156 688 255.186C757.071 441.559 989.5 -121.315 1389 98.6856C1708.6 274.686 1940.33 156.519 1964.5 98.6856"
              stroke="white"
              stroke-width="3"
              stroke-dasharray="2 2"
            />
          </svg>
          <div class="page-image">
            <img
              src="https://avatars.mds.yandex.net/i?id=d0aeed3e126419d3531a520644f40b9014eb7b2a-10272338-images-thumbs&n=13"
              alt="image"
              loading="lazy"
              style="width: 675px; height: 408px"
            />
          </div>
          <svg class="page-svg" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M21.1742 33.0065C14.029 35.2507 7.5486 39.0636 0 40.7339V86H1937V64.9942C1933.1 60.1623 1912.65 65.1777 1904.51 62.6581C1894.22 59.4678 1884.93 55.0079 1873.77 52.7742C1861.2 50.2585 1823.41 36.3854 1811.99 39.9252C1805.05 42.0727 1796.94 37.6189 1789.36 36.6007C1769.18 33.8879 1747.19 31.1848 1726.71 29.7718C1703.81 28.1919 1678.28 27.0012 1657.53 34.4442C1636.45 42.005 1606.07 60.856 1579.5 55.9191C1561.6 52.5906 1543.41 47.0959 1528.45 56.9075C1510.85 68.4592 1485.74 74.2518 1460.44 76.136C1432.32 78.2297 1408.53 70.6879 1384.73 62.2987C1339.52 46.361 1298.19 27.1677 1255.08 9.28534C1242.58 4.10111 1214.68 15.4762 1200.55 16.6533C1189.77 17.5509 1181.74 15.4508 1172.12 12.8795C1152.74 7.70033 1133.23 2.88525 1111.79 2.63621C1088.85 2.36971 1073.94 7.88289 1056.53 15.8446C1040.01 23.3996 1027.48 26.1777 1007.8 26.1777C993.757 26.1777 975.854 25.6887 962.844 28.9632C941.935 34.2258 932.059 38.7874 914.839 28.6037C901.654 20.8061 866.261 -2.56499 844.356 7.12886C831.264 12.9222 820.932 21.5146 807.663 27.5255C798.74 31.5679 779.299 42.0561 766.33 39.1166C758.156 37.2637 751.815 31.6349 745.591 28.2443C730.967 20.2774 715.218 13.2948 695.846 10.723C676.168 8.11038 658.554 23.1787 641.606 27.4357C617.564 33.4742 602.283 27.7951 579.244 27.7951C568.142 27.7951 548.414 30.4002 541.681 23.6618C535.297 17.2722 530.162 9.74921 523.263 3.71444C517.855 -1.01577 505.798 -0.852017 498.318 2.09709C479.032 9.7007 453.07 10.0516 431.025 9.64475C407.556 9.21163 368.679 1.61612 346.618 10.3636C319.648 21.0575 291.717 53.8338 254.67 45.2266C236.134 40.9201 225.134 37.5813 204.78 40.7339C186.008 43.6415 171.665 50.7785 156.051 57.3567C146.567 61.3523 152.335 52.6281 151.12 47.9222C149.535 41.7853 139.994 34.5585 132.991 30.4008C120.206 22.8098 90.2848 24.3246 74.2546 24.6502C55.5552 25.0301 37.9201 27.747 21.1742 33.0065Z"
              fill="#FFFAF3"
            />
          </svg>
          <div class="shape shape-one"><span></span></div>
          <div class="shape shape-two"><span></span></div>
          <div class="shape shape-three">
            <span
              ><img
                src="assets/images/shape/curved-arrow.png"
                alt="Image"
                loading="lazy"
            /></span>
          </div>
          <div class="shape shape-four">
            <span
              ><img
                src="assets/images/shape/stars.png"
                alt="Image"
                loading="lazy"
            /></span>
          </div>
          <div class="container">
            <div class="row">
              <div class="col-lg-6">
                <div class="page-banner-content">
                  <h1>Shop Details</h1>
                  <ul class="breadcrumb-link">
                    <li><a href="index.html">Home</a></li>
                    <li><i class="far fa-long-arrow-right"></i></li>
                    <li class="active">Shop Details</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="shop-details-section pt-120 pb-80">
        <div class="container">
          <div class="shop-details-wrapper">
            <div class="row">
              <div class="col-xl-6">
                <div
                  class="product-gallery-area mb-50"
                  data-aos="fade-up"
                  data-aos-duration="1200"
                >
                  <div class="product-big-slider mb-30 slider-details">
                    <div class="product-img"></div>
                  </div>

                  <div class="swiper product-thumb-slider">
                    <div class="swiper-wrapper"></div>
                  </div>
                </div>
              </div>

              <div class="col-xl-6">
                <div
                  class="product-info mb-50"
                  data-aos="fade-up"
                  data-aos-duration="1400"
                >
                  <span class="sale"></span>
                  <h4 class="title"></h4>
                  <h4 class="store d-none"></h4>
                  <h4 class="stock d-none"></h4>
                  <p></p>
                  <div class="product-price">
                    <span class="price prev-price"
                      ><span class="currency"></span
                    ></span>
                    <span class="price new-price"
                      ><span class="currency"></span
                    ></span>
                  </div>

                  <div class="product-color">
                    <h4 class="mb-15">Color</h4>
                    <ul class="color-list mb-20"></ul>
                  </div>

                  <div class="product-size">
                    <h4 class="mb-15">Size</h4>
                    <ul class="size-list mb-30"></ul>
                  </div>

                  <div class="product-cart-variation">
                    <ul>
                      <li>
                        <div class="quantity-input">
                          <button class="quantity-down">
                            <i class="far fa-minus"></i>
                          </button>
                          <input
                            class="quantity"
                            type="text"
                            value="1"
                            name="quantity"
                          />
                          <button class="quantity-up">
                            <i class="far fa-plus"></i>
                          </button>
                        </div>
                      </li>

                      <li>
                        <a
                          href=""
                          class="theme-btn style-one"
                          id="add-to-cart-btn"
                          >Add To cart</a
                        >
                      </li>

                      <li>
                        <a href="" class="icon-btn" id="add-to-wishlist-btn"
                          ><i class="far fa-heart"></i
                        ></a>
                      </li>
                      <li>
                        <a href="shop-details.html" class="icon-btn"
                          ><i class="far fa-sync"></i
                        ></a>
                      </li>
                    </ul>
                  </div>

                  <div class="product-meta">
                    <ul>
                      <li></li>
                      <li><span>Category :</span>Women Cloths</li>

                      <li>
                        <span>Share :</span>
                        <a href="https://www.facebook.com/" target="_blank"
                          ><i class="fab fa-facebook-f"></i
                        ></a>
                        <a href="https://www.linkedin.com/" target="_blank"
                          ><i class="fab fa-linkedin-in"></i
                        ></a>
                        <a href="https://www.instagram.com/" target="_blank"
                          ><i class="fab fa-instagram"></i
                        ></a>
                        <a href="https://www.twitter.com/" target="_blank"
                          ><i class="fab fa-twitter"></i
                        ></a>
                      </li>
                    </ul>
                  </div>
                  <div class="special-features">
                    <span
                      ><i class="far fa-shipping-fast"></i>Free Shipping</span
                    >
                    <span><i class="far fa-box-open"></i>Easy Returns</span>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="additional-information-wrapper"
              data-aos="fade-up"
              data-aos-delay="30"
              data-aos-duration="1000"
            >
              <div class="row">
                <div class="col-lg-5">
                  <div class="additional-info-box mb-40">
                    <h3>Additional Information:</h3>
                    <ul></ul>
                  </div>
                </div>
                <div class="col-lg-7">
                  <div class="description-wrapper mb-40">
                    <div class="pesco-tabs style-two mb-50">
                      <ul class="nav nav-tabs">
                        <li>
                          <button
                            class="nav-link active"
                            data-bs-toggle="tab"
                            data-bs-target="#description"
                          >
                            Description
                          </button>
                        </li>
                        <li>
                          <button
                            class="nav-link"
                            data-bs-toggle="tab"
                            data-bs-target="#reviews"
                          >
                            Reviews
                          </button>
                        </li>
                      </ul>
                    </div>

                    <div class="tab-content">
                      <div class="tab-pane fade active show" id="description">
                        <h4>Description</h4>
                        <p></p>
                      </div>

                      <div class="tab-pane fade" id="reviews">
                        <div class="pesco-comment-area mb-80">
                          <h4>
                            Total Reviews (<span id="review-count">0</span>)
                          </h4>
                          <ul>
                            <li class="comment"></li>
                          </ul>
                        </div>

                        <div class="reviews-contact-area">
                          <h4>Write Comment</h4>
                          <ul class="ratings rating-stars mb-40">
                            <li data-value="1"><i class="fas fa-star"></i></li>
                            <li data-value="2"><i class="fas fa-star"></i></li>
                            <li data-value="3"><i class="fas fa-star"></i></li>
                            <li data-value="4"><i class="fas fa-star"></i></li>
                            <li data-value="5"><i class="fas fa-star"></i></li>
                          </ul>

                          <form
                            id="reviewForm"
                            class="pesco-contact-form"
                            enctype="multipart/form-data"
                          >
                            <input
                              type="hidden"
                              name="star"
                              id="starRating"
                              value="0"
                            />
                            <input
                              type="hidden"
                              name="product_name"
                              id="reviewProductName"
                            />
                            <input
                              type="hidden"
                              name="product_image"
                              id="productImage"
                              value=""
                            />
                            <div class="row">
                              <div class="col-lg-6">
                                <div class="form-group">
                                  <input
                                    type="text"
                                    placeholder="Name"
                                    class="form_control"
                                    name="user_name"
                                    required
                                  />
                                </div>
                              </div>
                              <div class="col-lg-6">
                                <div class="form-group">
                                  <input
                                    type="email"
                                    placeholder="Email"
                                    class="form_control"
                                    name="email"
                                    required
                                  />
                                </div>
                              </div>
                              <div class="col-lg-12">
                                <div class="form-group">
                                  <textarea
                                    class="form_control"
                                    placeholder="Write Reviews"
                                    name="comment"
                                    cols="5"
                                    rows="10"
                                    required
                                  ></textarea>
                                </div>
                              </div>
                              <div class="col-lg-12">
                                <div class="form-group">
                                  <button
                                    class="theme-btn style-one"
                                    type="submit"
                                  >
                                    Submit Review
                                  </button>
                                </div>
                              </div>
                            </div>
                          </form>

                          <div
                            id="review-success-banner"
                            style="
                              display: none;
                              padding: 10px;
                              background: #28a745;
                              color: white;
                              margin-top: 15px;
                            "
                          >
                            ✅ Your review has been submitted successfully!
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <script>
        document.addEventListener("DOMContentLoaded", () => {
          let currentProduct;

          function toSeoSlug(s) {
            if (!s) return "";
            return s
              .toString()
              .trim()
              .toLowerCase()
              .replace(/\s+/g, "-")
              .replace(/[^a-z0-9\-]/g, "")
              .replace(/-+/g, "-")
              .replace(/^-|-$/g, "");
          }

          function sanitizeHtml(input) {
            try {
              if (!input) return "";
              const parser = new DOMParser();
              const doc = parser.parseFromString(input, "text/html");

              doc.querySelectorAll("script,style").forEach((n) => n.remove());

              const allowedTags = new Set([
                "P",
                "BR",
                "STRONG",
                "B",
                "EM",
                "I",
                "UL",
                "OL",
                "LI",
                "A",
                "SPAN",
                "IMG",
                "H1",
                "H2",
                "H3",
                "H4",
                "H5",
                "H6",
                "DIV",
              ]);

              const elems = Array.from(doc.body.querySelectorAll("*"));

              elems.forEach((el) => {
                const tag = el.tagName.toUpperCase();
                if (!allowedTags.has(tag)) {
                  const parent = el.parentNode;
                  while (el.firstChild) parent.insertBefore(el.firstChild, el);
                  parent.removeChild(el);
                  return;
                }

                Array.from(el.attributes).forEach((attrNode) => {
                  const name = attrNode.name.toLowerCase();
                  const val = attrNode.value;
                  if (name.startsWith("on")) {
                    el.removeAttribute(attrNode.name);
                    return;
                  }
                  if (tag === "A") {
                    if (name === "href") {
                      try {
                        const u = new URL(val, window.location.origin);
                        if (
                          u.protocol !== "http:" &&
                          u.protocol !== "https:" &&
                          !val.startsWith("/")
                        ) {
                          el.removeAttribute(attrNode.name);
                        } else {
                          el.setAttribute("href", u.href);
                        }
                      } catch {
                        el.removeAttribute(attrNode.name);
                      }
                      return;
                    }
                    el.removeAttribute(attrNode.name);
                    return;
                  }
                  if (tag === "IMG") {
                    if (name === "src") {
                      try {
                        const u = new URL(val, window.location.origin);
                        if (u.protocol === "javascript:")
                          el.removeAttribute(attrNode.name);
                        else el.setAttribute("src", u.href);
                      } catch {
                        el.removeAttribute(attrNode.name);
                      }
                      return;
                    }
                    if (name === "alt") {
                      el.setAttribute("alt", val);
                      return;
                    }
                    el.removeAttribute(attrNode.name);
                    return;
                  }
                  el.removeAttribute(attrNode.name);
                });
              });

              return doc.body.innerHTML || "";
            } catch (e) {
              return (input || "").replace(/<\/?[^>]+(>|$)/g, "");
            }
          }

          (async function () {
            try {
              const res = await fetch("/api/productpagedata");
              if (!res.ok) throw new Error("Network response was not ok");
              const products = await res.json();
              if (!Array.isArray(products) || products.length === 0) return;

              let pathSlug = "";
              try {
                const pathParts = window.location.pathname
                  .replace(/\/+$/, "")
                  .split("/");
                pathSlug = decodeURIComponent(
                  pathParts[pathParts.length - 1] || ""
                );
              } catch (e) {
                pathSlug = "";
              }

              const params = new URLSearchParams(window.location.search);
              const pid = params.get("id");

              if (pathSlug && pathSlug !== "shop-details") {
                currentProduct =
                  products.find((p) => {
                    const candidate = (
                      p.permalink ||
                      p.slug ||
                      toSeoSlug(p.name) ||
                      String(p.id)
                    ).toString();
                    return candidate === pathSlug.toString();
                  }) ||
                  (pid ? products.find((p) => String(p.id) === pid) : null) ||
                  products[0];
              } else if (pid) {
                currentProduct =
                  products.find((p) => String(p.id) === pid) || products[0];
              } else {
                currentProduct = products[0];
              }

              if (!currentProduct) currentProduct = products[0];

              const reviewNameInput =
                document.getElementById("reviewProductName");
              if (reviewNameInput)
                reviewNameInput.value = currentProduct.name || "";

              const productImageInput = document.getElementById("productImage");
              if (productImageInput)
                productImageInput.value = currentProduct.image || "";

              const titleEl = document.querySelector(".product-info .title");
              if (titleEl) titleEl.textContent = currentProduct.name || "";

              const storeEl = document.querySelector(".product-info .store");
              if (storeEl) storeEl.textContent = currentProduct.store || "";

              const stockEl = document.querySelector(".product-info .stock");
              if (stockEl)
                stockEl.textContent = currentProduct.stockstatus || "";

              const productInfoP = document.querySelector(".product-info p");
              const descriptionBlock = document.querySelector("#description p");
              const sanitized = sanitizeHtml(currentProduct.description || "");
              if (productInfoP) productInfoP.innerHTML = sanitized;
              if (descriptionBlock) descriptionBlock.innerHTML = sanitized;

              try {
                const prevEl = document.querySelector(".prev-price");
                if (prevEl) {
                  prevEl.innerHTML = `<span class="currency">$</span>${(
                    currentProduct.price_sale || ""
                  )
                    .toString()
                    .replace("$", "")}`;
                }
                const newEl = document.querySelector(".new-price");
                if (newEl) {
                  newEl.innerHTML = `<span class="currency ms-2">$</span>${(
                    currentProduct.price || ""
                  )
                    .toString()
                    .replace("$", "")}`;
                }
              } catch (e) {
                console.warn("Price render failed", e);
              }

              try {
                const bigSlider = document.querySelector(".product-big-slider");
                const thumbSlider = document.querySelector(
                  ".product-thumb-slider"
                );
                if (bigSlider) bigSlider.innerHTML = "";
                if (thumbSlider) thumbSlider.innerHTML = "";
                const imagesRaw = (currentProduct.image || "").toString();
                const imgs = imagesRaw ? imagesRaw.split(",") : [];
                imgs.forEach((img) => {
                  const clean = img.trim();
                  if (!clean) return;
                  if (bigSlider) {
                    bigSlider.insertAdjacentHTML(
                      "beforeend",
                      `<div class="product-img">
                        <a href="#" class="img-popup">
                          <img src="/api/uploads/${clean}" alt="${(
                        currentProduct.name || ""
                      ).replace(/"/g, "&quot;")}">
                        </a>
                      </div>`
                    );
                  }
                  if (thumbSlider) {
                    thumbSlider.insertAdjacentHTML(
                      "beforeend",
                      `<div class="product-img">
                        <img src="/api/uploads/${clean}" alt="${(
                        currentProduct.name || ""
                      ).replace(/"/g, "&quot;")}">
                      </div>`
                    );
                  }
                });
              } catch (e) {
                console.warn("Slider build failed", e);
              }

              const saleEl = document.querySelector(".product-info .sale");
              if (saleEl) {
                const label = (currentProduct.label || "")
                  .toString()
                  .toUpperCase();
                saleEl.innerHTML = label
                  ? `<i class="fas fa-tags"></i>${label} OFFER`
                  : "";
              }

              try {
                const meta = document.querySelector(".product-meta ul");
                if (meta) {
                  const firstCategory =
                    (currentProduct.categories || "").split(",")[0] || "";
                  const tagsHtml = (currentProduct.tags || "")
                    .split(",")
                    .map((t) => t.trim())
                    .filter(Boolean)
                    .map((t) => `<a href="#">${t}</a>`)
                    .join(", ");
                  meta.innerHTML = `
                    <li><span>SKU :</span>${currentProduct.sku || ""}</li>
                    <li><span>Category :</span>${firstCategory}</li>
                    ${
                      tagsHtml ? `<li><span>Tags :</span> ${tagsHtml}</li>` : ""
                    }
                    <li><span>Share :</span>
                      <a href="https://www.facebook.com/" target="_blank" rel="noreferrer"><i class="fab fa-facebook-f"></i></a>
                      <a href="https://www.linkedin.com/" target="_blank" rel="noreferrer"><i class="fab fa-linkedin-in"></i></a>
                      <a href="https://www.instagram.com/" target="_blank" rel="noreferrer"><i class="fab fa-instagram"></i></a>
                      <a href="https://www.twitter.com/" target="_blank" rel="noreferrer"><i class="fab fa-twitter"></i></a>
                    </li>`;
                }
              } catch (e) {
                console.warn("Meta build failed", e);
              }

              try {
                const attributes = (currentProduct.attribute || "")
                  .split(",")
                  .map((s) => s.trim())
                  .filter(Boolean);
                const colors = [];
                const sizes = [];

                attributes.forEach((attr) => {
                  const [key, value] = attr.split(":").map((x) => x.trim());
                  if (!key || !value) return;
                  if (key.toLowerCase() === "color") {
                    value.split("/").forEach((v) => {
                      const colorName = v.trim();
                      if (colorName && !colors.includes(colorName))
                        colors.push(colorName);
                    });
                  } else if (key.toLowerCase() === "size") {
                    value.split("/").forEach((v) => {
                      const size = v.trim();
                      if (size && !sizes.includes(size)) sizes.push(size);
                    });
                  }
                });

                const colorList = document.querySelector(
                  ".product-color .color-list"
                );
                if (colorList) {
                  colorList.innerHTML = "";
                  if (colors.length > 0) {
                    colors.forEach((color, index) => {
                      const colorId = `color${index + 1}`;
                      const bg = color.toLowerCase();
                      colorList.insertAdjacentHTML(
                        "beforeend",
                        `<li>
                          <div class="form-check">
                            <input class="form-check-input" type="radio" name="color" value="${color}" id="${colorId}">
                            <label class="form-check-label" for="${colorId}">
                              <span style="display:inline-block;width:20px; height:18px;border-radius:50%;background-color:${bg};border:1px solid #ccc;" title="${color}"></span>
                            </label>
                          </div>
                        </li>`
                      );
                    });
                  } else {
                    colorList.innerHTML = `<li class="text-danger">No color available</li>`;
                  }
                }

                const sizeList = document.querySelector(
                  ".product-size .size-list"
                );
                if (sizeList) {
                  sizeList.innerHTML = "";
                  if (sizes.length > 0) {
                    sizes.forEach((size, index) => {
                      const sizeId = `size${index + 1}`;
                      sizeList.insertAdjacentHTML(
                        "beforeend",
                        `<li>
                          <div class="form-check">
                            <input class="form-check-input" type="radio" name="size" value="${size}" id="${sizeId}">
                            <label class="form-check-label" for="${sizeId}">
                              ${size}
                            </label>
                          </div>
                        </li>`
                      );
                    });
                  } else {
                    sizeList.innerHTML = `<li class="text-danger">No size available</li>`;
                  }
                }

                const addInfo = document.querySelector(
                  ".additional-info-box ul"
                );
                if (addInfo) {
                  addInfo.innerHTML = "";
                  attributes.forEach((attr) => {
                    const [k, v] = attr.split(":").map((x) => x.trim());
                    if (
                      k &&
                      v &&
                      k.toLowerCase() !== "color" &&
                      k.toLowerCase() !== "size"
                    ) {
                      addInfo.insertAdjacentHTML(
                        "beforeend",
                        `<li>${k} <span>${v}</span></li>`
                      );
                    }
                  });
                }
              } catch (e) {
                console.warn("Attribute parsing failed", e);
              }

              document.title = currentProduct.name || document.title;

              try {
                window.initAOS?.();
                window.initSliders?.();
              } catch (e) {
                console.warn("Init functions failed", e);
              }
            } catch (err) {
              console.error("Error fetching product data:", err);
            }
          })();

          function showBanner(msg, type = "success") {
            document.getElementById("cart-banner")?.remove();
            const b = document.createElement("div");
            b.id = "cart-banner";
            b.textContent = msg;
            Object.assign(b.style, {
              position: "fixed",
              top: 0,
              left: "50%",
              transform: "translateX(-50%)",
              padding: "0.8rem 1.2rem",
              backgroundColor: type === "success" ? "#28a745" : "#dc3545",
              color: "#fff",
              borderRadius: "4px",
              zIndex: 9999,
            });
            document.body.appendChild(b);
            setTimeout(() => b.remove(), 1500);
          }

          document
            .getElementById("add-to-cart-btn")
            ?.addEventListener("click", async (e) => {
              e.preventDefault();
              const uid = localStorage.getItem("user_id");
              if (!uid) return showBanner("Please log in.", "error");

              if (!currentProduct)
                return showBanner("Product not loaded yet.", "error");

              const qtyInput = document.querySelector(".quantity");
              const quantity = qtyInput ? parseInt(qtyInput.value, 10) || 1 : 1;
              const selectedColor =
                document.querySelector('input[name="color"]:checked')?.value ||
                null;
              const selectedSize =
                document.querySelector('input[name="size"]:checked')?.value ||
                null;

              const payload = {
                user_id: uid,
                name: currentProduct.name,
                store: currentProduct.store,
                price: (currentProduct.price || "")
                  .toString()
                  .replace(/[^0-9.]/g, ""),
                price_sale: (currentProduct.price_sale || "")
                  .toString()
                  .replace(/[^0-9.]/g, ""),
                image: (currentProduct.image || "").split(",")[0].trim(),
                quantity: quantity,
                color: selectedColor,
                size: selectedSize,
              };

              try {
                const resp = await fetch("/api/addcart", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(payload),
                });
                if (!resp.ok) throw new Error(await resp.text());
                showBanner("Added to cart!");
              } catch (err) {
                console.error(err);
                showBanner("Cart error", "error");
              }
            });

          document
            .getElementById("add-to-wishlist-btn")
            ?.addEventListener("click", async (e) => {
              e.preventDefault();
              const uid = localStorage.getItem("user_id");
              if (!uid) return showBanner("Please log in.", "error");
              if (!currentProduct)
                return showBanner("Product not loaded yet.", "error");

              const selectedColor =
                document.querySelector('input[name="color"]:checked')?.value ||
                null;
              const selectedSize =
                document.querySelector('input[name="size"]:checked')?.value ||
                null;

              const payload = {
                user_id: uid,
                product_name: currentProduct.name,
                store: currentProduct.store,
                sku: currentProduct.sku,
                price: (currentProduct.price || "")
                  .toString()
                  .replace(/[^0-9.]/g, ""),
                price_sale: (currentProduct.price_sale || "")
                  .toString()
                  .replace(/[^0-9.]/g, ""),
                stockstatus: currentProduct.stockstatus,
                image: (currentProduct.image || "").split(",")[0].trim(),
                quantity: document.querySelector(".quantity")?.value || "1",
                color: selectedColor,
                size: selectedSize,
              };

              try {
                const resp = await fetch("/api/wishlistpost", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(payload),
                });
                if (!resp.ok) throw new Error(await resp.text());
                showBanner("Added to wishlist!");
              } catch (err) {
                console.error(err);
                showBanner("Wishlist error", "error");
              }
            });

          let selectedRating = 0;
          const stars = Array.from(
            document.querySelectorAll(".rating-stars li[data-value]") || []
          );
          const starInput = document.getElementById("starRating");
          const reviewForm = document.getElementById("reviewForm");
          const successBanner = document.getElementById(
            "review-success-banner"
          );

          stars.forEach((star) => {
            star.addEventListener("click", () => {
              selectedRating = +star.dataset.value;
              if (starInput) starInput.value = selectedRating;
              stars.forEach((s) =>
                s.classList.toggle("filled", +s.dataset.value <= selectedRating)
              );
            });
          });

          reviewForm?.addEventListener("submit", async (e) => {
            e.preventDefault();
            if (selectedRating < 1)
              return alert("Please select a star rating.");
            const formData = new FormData(reviewForm);
            try {
              const res = await fetch("/api/reviewdatasubmit", {
                method: "POST",
                body: formData,
              });
              if (!res.ok) throw new Error(await res.text());
              reviewForm.reset();
              selectedRating = 0;
              stars.forEach((s) => s.classList.remove("filled"));
              if (successBanner) {
                successBanner.style.display = "block";
                setTimeout(() => (successBanner.style.display = "none"), 3000);
              }
            } catch (err) {
              console.error(err);
              alert("Submit failed");
            }
          });

          function fetchAndRenderReviews() {
            if (!currentProduct) return;
            fetch("/api/reviewdata")
              .then((r) => {
                if (!r.ok) throw new Error("Failed to fetch reviews");
                return r.json();
              })
              .then((all) => {
                const nameKey = (currentProduct.name || "")
                  .trim()
                  .toLowerCase();
                const matched = (all || []).filter(
                  (r) => (r.product_name || "").trim().toLowerCase() === nameKey
                );

                const ul = document.querySelector("#reviews ul");
                if (!ul) return;
                ul.innerHTML = "";
                document.getElementById("review-count").textContent =
                  matched.length || 0;

                if (matched.length === 0) {
                  ul.insertAdjacentHTML(
                    "beforeend",
                    `<li class="no-reviews text-danger fw-bold">No reviews available for this product.</li>`
                  );
                  return;
                }

                matched.forEach((r) => {
                  const date = new Date(r.date).toLocaleDateString("en-GB", {
                    day: "2-digit",
                    month: "long",
                    year: "numeric",
                  });
                  const starsHtml = Array(5)
                    .fill(0)
                    .map(
                      (_, i) =>
                        `<li><i class="fas fa-star" style="color:${
                          i < r.star ? "#cc0d39" : "black"
                        }"></i></li>`
                    )
                    .join("");

                  const li = document.createElement("li");
                  li.className = "comment";
                  li.innerHTML = `
                    <div class="pesco-reviews-item">
                      <div class="author-thumb-info">
                        <div class="author-thumb">
                          <img src="https://liccar.com/wp-content/api/png-transparent-head-the-dummy-avatar-man-tie-jacket-user.png" alt="Author">
                        </div>
                        <div class="author-info">
                          <h5>${(r.user_name || "").replace(/</g, "&lt;")}</h5>
                          <div class="author-meta">
                            <ul class="ratings">${starsHtml}</ul>
                            <span>${date}</span>
                          </div>
                        </div>
                      </div>
                      <div class="author-review-content">
                        <p>${(r.comment || "").replace(/</g, "&lt;")}</p>
                      </div>
                    </div>`;
                  ul.appendChild(li);
                });
              })
              .catch((err) => console.error(err));
          }

          window.addEventListener("load", () => {
            fetchAndRenderReviews();
            setInterval(fetchAndRenderReviews, 1000);
          });
        });
      </script>

      <section class="releted-product-section pb-90">
        <div class="container">
          <div class="row">
            <div class="col-md-8">
              <div
                class="section-title mb-50"
                data-aos="fade-right"
                data-aos-delay="50"
                data-aos-duration="1000"
              >
                <div class="sub-heading d-inline-flex align-items-center">
                  <i class="flaticon-sparkler"></i>
                  <span class="sub-title">Releted Products</span>
                </div>
                <h2>Customers also purchased</h2>
              </div>
            </div>
            <div class="col-md-4">
              <div
                class="releted-product-arrows style-one mb-50"
                data-aos="fade-left"
                data-aos-delay="70"
                data-aos-duration="1300"
              ></div>
            </div>
          </div>

          <div class="releted-product-slider"></div>
        </div>
      </section>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const BASE_IMAGE_URL = "/api/uploads/";
          const sliderContainer = document.querySelector(
            ".releted-product-slider"
          );
          if (!sliderContainer) return;

          function showBanner(msg, type = "success") {
            const b = document.createElement("div");
            b.className = `banner ${type}`;
            b.textContent = msg;
            Object.assign(b.style, {
              position: "fixed",
              top: "10px",
              left: "50%",
              transform: "translateX(-50%)",
              padding: "10px 20px",
              background: type === "success" ? "#28a745" : "#dc3545",
              color: "#fff",
              borderRadius: "4px",
              zIndex: 9999,
              boxShadow: "0 2px 6px rgba(0,0,0,0.3)",
            });
            document.body.appendChild(b);
            setTimeout(() => b.remove(), 3000);
          }

          function parsePrice(val) {
            if (!val) return 0;
            const num = parseFloat(val.toString().replace(/[^0-9.]/g, ""));
            return isNaN(num) ? 0 : num;
          }

          async function loadSidebarCart() {
            try {
              const res = await fetch("/api/allcartdata");
              const items = await res.json();
              const listEl = document.querySelector(".pesco-mini-cart-list");
              const subtotalEl = document.querySelector(
                ".cart-mini-total .amount"
              );

              const seen = new Set();
              const unique = items.filter((item) => {
                if (seen.has(item.name)) return false;
                seen.add(item.name);
                return true;
              });

              listEl.innerHTML = "";
              if (!unique.length) {
                listEl.innerHTML = `<li class="sidebar-cart-item sidebar-cart-empty">Your cart is empty.</li>`;
                subtotalEl.textContent = "$0.00";
                return;
              }

              let total = 0;
              unique.forEach((item) => {
                const price =
                  parsePrice(item.price_sale) || parsePrice(item.price);
                const qty = parseInt(item.quantity || 1, 10);
                total += price * qty;

                listEl.insertAdjacentHTML(
                  "beforeend",
                  `<li class="sidebar-cart-item" data-id="${
                    item.id
                  }" data-price="${price.toFixed(2)}" data-qty="${qty}">
                <a href="javascript:void(0)" class="remove-cart"><i class="far fa-trash-alt"></i></a>
                <span class="cart-product-name"><img src="${BASE_IMAGE_URL}${
                    item.image
                  }" alt="${item.name}" /> ${item.name}</span>
                <span class="quantity">${qty} × <span><span class="currency">$</span>${price.toFixed(
                    2
                  )}</span></span>
              </li>`
                );
              });

              subtotalEl.textContent = `$${total.toFixed(2)}`;
            } catch (err) {
              console.error("Sidebar load error:", err);
            }
          }

          async function updateCounts() {
            try {
              const badgeEl = document.querySelector("#pro-counts");
              const wishlistEl = document.querySelector("#pro-counts1");

              const [cartRes, wishRes] = await Promise.all([
                fetch("/api/allcartdata"),
                fetch("/api/wishlistdata"),
              ]);

              const cartItems = await cartRes.json();
              const wishItems = await wishRes.json();

              badgeEl.textContent = String(
                new Set(cartItems.map((i) => i.name)).size
              ).padStart(2, "0");
              wishlistEl.textContent = String(
                new Set(wishItems.map((i) => i.product_name)).size
              ).padStart(2, "0");
            } catch (err) {
              console.error("Count update failed:", err);
            }
          }

          function toSlug(str) {
            return (str || "")
              .toLowerCase()
              .trim()
              .replace(/\s+/g, "-")
              .replace(/[^\w-]+/g, "");
          }

          function createProductItem(product) {
            const wrap = document.createElement("div");
            wrap.className = "product-item style-one mb-40";
            wrap.setAttribute("data-aos", "fade-up");

            const thumb = document.createElement("div");
            thumb.className = "product-thumbnail";

            const img = document.createElement("img");
            img.alt = product.name || "Products";
            img.src = product.image
              ? BASE_IMAGE_URL + product.image
              : BASE_IMAGE_URL + "placeholder.png";
            thumb.appendChild(img);

            img.style.cursor = "pointer";
            img.addEventListener("click", () => {
              const slug = product.permalink
                ? toSlug(product.permalink)
                : toSlug(product.name);
              window.location.href = `/shop-details/${slug}`;
            });

            if (product.label || product.label1) {
              const discount = document.createElement("div");
              discount.className = "discount";
              discount.textContent = product.label || product.label1;
              thumb.appendChild(discount);
            }

            const hover = document.createElement("div");
            hover.className = "hover-content";

            const favBtn = document.createElement("a");
            favBtn.className = "icon-btn add-to-wishlist";
            favBtn.href = "javascript:void(0)";
            favBtn.dataset.name = product.name || "";
            favBtn.dataset.store = product.store || "";
            favBtn.dataset.image = product.image || "placeholder.png";
            favBtn.dataset.price = parsePrice(product.price).toFixed(2);
            favBtn.dataset.price_sale = parsePrice(
              product.price_sale || product.price
            ).toFixed(2);
            favBtn.dataset.sku = product.sku || "N/A";
            favBtn.dataset.stockstatus = product.stockstatus || "In Stock";
            favBtn.innerHTML = '<i class="fa fa-heart"></i>';
            hover.appendChild(favBtn);

            const popup = document.createElement("a");
            popup.className = "img-popup icon-btn";
            popup.href = product.image ? BASE_IMAGE_URL + product.image : "#";
            popup.innerHTML = '<i class="fa fa-eye"></i>';
            hover.appendChild(popup);

            thumb.appendChild(hover);

            const cartWrap = document.createElement("div");
            cartWrap.className = "cart-button";
            const cartLink = document.createElement("a");
            cartLink.className = "cart-btn add-to-cart";
            cartLink.href = "javascript:void(0)";
            cartLink.dataset.name = product.name || "";
            cartLink.dataset.store = product.store || "";
            cartLink.dataset.image = product.image || "placeholder.png";
            cartLink.dataset.price = parsePrice(product.price).toFixed(2);
            cartLink.dataset.price_sale = parsePrice(
              product.price_sale || product.price
            ).toFixed(2);
            cartLink.dataset.quantity = "1";
            cartLink.innerHTML =
              '<i class="far fa-shopping-basket"></i> <span class="text">Add To Cart</span>';
            cartWrap.appendChild(cartLink);
            thumb.appendChild(cartWrap);

            const infoWrap = document.createElement("div");
            infoWrap.className = "product-info-wrap";

            const info = document.createElement("div");
            info.className = "product-info";
            const ul = document.createElement("ul");
            ul.className = "ratings rating5";
            const starCount = Math.floor(Math.random() * 2) + 4;
            for (let i = 0; i < 5; i++) {
              const li = document.createElement("li");
              li.innerHTML =
                i < starCount
                  ? '<i class="fas fa-star"></i>'
                  : '<i class="far fa-star"></i>';
              ul.appendChild(li);
            }
            const reviewsCount = Math.floor(Math.random() * 100) + 1;
            const liCount = document.createElement("li");
            const aCount = document.createElement("a");
            aCount.href = "javascript:void(0)";
            aCount.textContent = "(" + reviewsCount + ")";
            liCount.appendChild(aCount);
            ul.appendChild(liCount);
            info.appendChild(ul);

            const h4 = document.createElement("h4");
            h4.className = "title";
            const aTitle = document.createElement("a");
            const slug = product.permalink
              ? toSlug(product.permalink)
              : toSlug(product.name);
            aTitle.href = `/shop-details/${slug}`;
            aTitle.textContent = product.name || "Product";
            h4.appendChild(aTitle);
            info.appendChild(h4);

            infoWrap.appendChild(info);

            const priceWrap = document.createElement("div");
            priceWrap.className = "product-price";
            const prev = document.createElement("span");
            prev.className = "price prev-price";
            prev.innerHTML =
              '<span class="currency">$</span>' +
              parsePrice(product.price_sale).toFixed(2);
            const todayPrice = document.createElement("span");
            todayPrice.className = "price new-price";
            todayPrice.innerHTML =
              '<span class="currency">$</span>' +
              parsePrice(product.price || product.price).toFixed(2);
            priceWrap.appendChild(prev);
            priceWrap.appendChild(todayPrice);
            infoWrap.appendChild(priceWrap);

            wrap.appendChild(thumb);
            wrap.appendChild(infoWrap);

            return wrap;
          }

          fetch("/api/productpagedata")
            .then((res) =>
              res.ok ? res.json() : Promise.reject("Network error")
            )
            .then((data) => {
              if (!Array.isArray(data)) return;

              sliderContainer.innerHTML = "";

              const published = data.filter(
                (p) => String(p.status || "").toLowerCase() === "published"
              );

              const seen = new Set();
              const uniqueProducts = published.filter((p) => {
                const key = p.id || p.permalink || p.name;
                if (seen.has(key)) return false;
                seen.add(key);
                return true;
              });

              const totalCountEl = document.getElementById("totalProductCount");
              if (totalCountEl)
                totalCountEl.textContent = uniqueProducts.length;

              uniqueProducts.forEach((prod, idx) => {
                const node = createProductItem(prod);
                node.setAttribute("data-aos-delay", 90 + idx * 20);
                node.setAttribute("data-aos-duration", 1500 + idx * 200);
                sliderContainer.appendChild(node);
              });

              if (typeof initRelatedProductSlider === "function")
                initRelatedProductSlider();
              else if (window.jQuery && jQuery.fn && jQuery.fn.slick) {
                const $el = jQuery(".releted-product-slider");
                $el.hasClass("slick-initialized")
                  ? $el.slick("refresh")
                  : $el.slick();
              }
            })
            .catch((err) => console.error("Failed to load products:", err));

          document.body.addEventListener("click", async (e) => {
            const cartBtn = e.target.closest(".add-to-cart");
            const wishBtn = e.target.closest(".add-to-wishlist");
            const removeBtn = e.target.closest(".remove-cart");

            if (removeBtn) {
              e.preventDefault();
              const li = removeBtn.closest("li.sidebar-cart-item");
              if (!li) return;
              const productId = li.dataset.id;
              if (!productId) return showBanner("Product ID missing", "error");

              try {
                const res = await fetch(`/api/deletecart/${productId}`, {
                  method: "DELETE",
                });
                if (!res.ok)
                  throw new Error((await res.text()) || `HTTP ${res.status}`);

                showBanner("Product removed from cart!", "success");
                loadSidebarCart();
                updateCounts();
              } catch (err) {
                console.error(err);
                showBanner(
                  "Failed to remove product from cart: " + err.message,
                  "error"
                );
              }
              return;
            }

            if (!cartBtn && !wishBtn) return;
            e.preventDefault();

            const userId = parseInt(localStorage.getItem("user_id") || "0", 10);
            if (!userId)
              return showBanner(
                wishBtn
                  ? "Please log in to add to wishlist."
                  : "Please log in to add to cart.",
                "error"
              );

            const payload = cartBtn
              ? {
                  user_id: userId,
                  name: cartBtn.dataset.name || "",
                  store: cartBtn.dataset.store || "",
                  image: cartBtn.dataset.image || "placeholder.png",
                  price: parseFloat(cartBtn.dataset.price),
                  price_sale: parseFloat(cartBtn.dataset.price_sale),
                  quantity: parseInt(cartBtn.dataset.quantity || "1", 10),
                }
              : {
                  user_id: userId,
                  product_name: wishBtn.dataset.name || "",
                  store: wishBtn.dataset.store || "",
                  image: wishBtn.dataset.image || "placeholder.png",
                  price: parseFloat(wishBtn.dataset.price),
                  price_sale: parseFloat(wishBtn.dataset.price_sale),
                  sku: wishBtn.dataset.sku || "N/A",
                  stockstatus: wishBtn.dataset.stockstatus || "In Stock",
                };

            try {
              const url = cartBtn ? "/api/addcart" : "/api/wishlistpost";
              const res = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });
              if (!res.ok)
                throw new Error((await res.text()) || `HTTP ${res.status}`);

              showBanner(
                cartBtn
                  ? "Product added to cart!"
                  : "Product added to wishlist!",
                "success"
              );
              if (cartBtn) loadSidebarCart();
              updateCounts();
            } catch (err) {
              console.error("Error:", err);
              showBanner(
                (cartBtn
                  ? "Add to cart failed: "
                  : "Add to wishlist failed: ") + err.message,
                "error"
              );
            }
          });

          loadSidebarCart();
          updateCounts();
          setInterval(updateCounts, 1000);
        });
      </script>

      <div
        id="lightboxContainer"
        style="
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.9);
          justify-content: center;
          align-items: center;
          z-index: 9999;
          flex-direction: column;
        "
      >
        <div
          style="
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
          "
        >
          <button
            id="lightboxPrevBtn"
            style="
              position: absolute;
              left: 20px;
              top: 50%;
              transform: translateY(-50%);
              font-size: 22px;
              color: white;
              background: none;
              border: none;
              cursor: pointer;
            "
          >
            <i class="fas fa-play" style="transform: rotate(180deg)"></i>
          </button>

          <div style="position: relative; display: inline-block">
            <img
              id="lightboxImage"
              src=""
              alt="Product"
              style="
                width: 336px;
                height: 400px;
                object-fit: contain;
                border-radius: 4px;
              "
            />

            <div
              id="lightboxCounter"
              style="
                position: absolute;
                bottom: 0;
                right: -2px;
                color: #fff;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 14px;
              "
            >
              1 of 0
            </div>

            <button
              id="lightboxCloseBtn"
              style="
                position: absolute;
                top: 0;
                right: -8px;
                font-size: 36px;
                color: white;
                border: none;
                border-radius: 50%;
                width: 32px;
                height: 32px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 0;
                z-index: 10;
              "
            >
              &times;
            </button>
          </div>

          <button
            id="lightboxNextBtn"
            style="
              position: absolute;
              right: 20px;
              top: 50%;
              transform: translateY(-50%);
              font-size: 22px;
              color: white;
              background: none;
              border: none;
              cursor: pointer;
            "
          >
            <i class="fas fa-play"></i>
          </button>
        </div>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const lbContainer = document.getElementById("lightboxContainer");
          const lbImage = document.getElementById("lightboxImage");
          const lbCounter = document.getElementById("lightboxCounter");
          const btnPrev = document.getElementById("lightboxPrevBtn");
          const btnNext = document.getElementById("lightboxNextBtn");
          const btnClose = document.getElementById("lightboxCloseBtn");

          let imageUrls = [];
          let currentIndex = 0;
          let realProductCount = 0;

          document.addEventListener("productsLoaded", (e) => {
            realProductCount = e.detail.count || 0;
          });

          function getRenderedAnchors() {
            return Array.from(
              document.querySelectorAll(
                ".releted-product-slider .product-item:not(.slick-cloned) .img-popup"
              )
            );
          }

          function collectImageUrls() {
            const set = new Set();
            getRenderedAnchors().forEach((a) =>
              set.add(a.dataset.img || a.href)
            );
            imageUrls = [...set];
          }

          function showLightbox(idx) {
            if (!imageUrls.length) return;
            currentIndex = (idx + imageUrls.length) % imageUrls.length;
            lbImage.src = imageUrls[currentIndex];
            const total = realProductCount || imageUrls.length;
            lbCounter.textContent = `${currentIndex + 1} of ${total}`;
            lbContainer.style.display = "flex";
          }

          function bindThumbnails() {
            getRenderedAnchors().forEach((a) => {
              a.removeEventListener("click", a._lbHandler);
              a._lbHandler = function (e) {
                e.preventDefault();
                collectImageUrls();
                const idx = imageUrls.indexOf(a.dataset.img || a.href);
                showLightbox(idx);
              };
              a.addEventListener("click", a._lbHandler);
            });
          }

          const galleryRoot = document.querySelector(".releted-product-slider");
          if (galleryRoot) {
            new MutationObserver(bindThumbnails).observe(galleryRoot, {
              childList: true,
              subtree: true,
            });
          }

          bindThumbnails();

          btnPrev.addEventListener("click", () =>
            showLightbox(currentIndex - 1)
          );
          btnNext.addEventListener("click", () =>
            showLightbox(currentIndex + 1)
          );
          btnClose.addEventListener("click", () => {
            lbContainer.style.display = "none";
          });

          window.addEventListener("keydown", (e) => {
            if (e.key === "Escape") lbContainer.style.display = "none";
            if (e.key === "ArrowLeft") showLightbox(currentIndex - 1);
            if (e.key === "ArrowRight") showLightbox(currentIndex + 1);
          });
        });
      </script>

      <section class="newsletter-section pb-95">
        <div class="container">
          <div
            class="newsletter-wrapper white-bg p-r z-1"
            data-aos="fade-up"
            data-aos-duration="1000"
          >
            <div class="newsletter-shape pattern-one">
              <span
                ><img
                  src="assets/images/newsletter/pattern-1.png"
                  alt="Pattern Shape"
                  loading="lazy"
              /></span>
            </div>
            <div class="newsletter-shape pattern-two">
              <span
                ><img
                  src="assets/images/newsletter/pattern-2.png"
                  alt="Pattern Shape"
                  loading="lazy"
              /></span>
            </div>
            <div class="newsletter-shape shape-one">
              <span
                ><img
                  src="assets/images/newsletter/shape-1.png"
                  alt="Shape"
                  loading="lazy"
              /></span>
            </div>
            <div class="row">
              <div class="col-lg-6">
                <div class="newsletter-content-box">
                  <span class="sub-text">Our Newsletter</span>
                  <h3>
                    Get weekly update. Sign up and get up to
                    <span>20% off</span> your first purchase
                  </h3>
                  <form>
                    <div class="form-group">
                      <input
                        type="email"
                        class="form_control"
                        placeholder="Write your Email Address"
                        name="email"
                        required
                      />
                      <button class="theme-btn style-one" type="submit">
                        Subscribe
                      </button>
                    </div>
                  </form>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="newsletter-image">
                  <img
                    src="https://avatars.mds.yandex.net/i?id=802770c3379c394673fcc33bea11d6b7952ceffd-4012107-images-thumbs&n=13"
                    alt="Image"
                    loading="lazy"
                    style="width: 511px; height: 360px"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.querySelector(".newsletter-section form");
        if (!form) return;

        function showBanner(msg, type = "success") {
          const b = document.createElement("div");
          b.className = `banner ${type}`;
          b.textContent = msg;
          Object.assign(b.style, {
            position: "fixed",
            top: "10px",
            left: "50%",
            transform: "translateX(-50%)",
            padding: "10px 20px",
            background: type === "success" ? "#4caf50" : "#f44336",
            color: "#fff",
            borderRadius: "4px",
            zIndex: 9999,
            boxShadow: "0 2px 6px rgba(0,0,0,0.3)",
          });
          document.body.appendChild(b);
          setTimeout(() => b.remove(), 3000);
        }

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const input = form.querySelector('input[name="email"]');
          const email = input.value.trim();
          if (!email) {
            showBanner("Please enter a valid email.", "error");
            return;
          }

          try {
            const res = await fetch("/api/newsletterpost", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email }),
            });
            const text = await res.text();
            if (res.ok) {
              showBanner("Subscribed successfully!", "success");
              form.reset();
            } else {
              showBanner(text || "Subscription failed.", "error");
            }
          } catch (err) {
            console.error("Newsletter error:", err);
            showBanner("Network error, please try again.", "error");
          }
        });
      });
    </script>

    <footer class="footer-main">
      <div class="footer-bg-wrapper gray-light-bg pt-0">
        <div class="footer-shape shape-one">
          <span
            ><img
              src="assets/images/footer/shape-1.png"
              alt="shape"
              loading="lazy"
          /></span>
        </div>
        <div class="footer-widget-area pb-80">
          <div class="container">
            <div class="row">
              <div class="col-xl-3 col-sm-6">
                <div
                  class="footer-widget about-company-widget mb-40"
                  data-aos="fade-up"
                  data-aos-delay="10"
                  data-aos-duration="1000"
                >
                  <div class="widget-content">
                    <a href="index.html" class="footer-logo"
                      ><img
                        src="assets/images/logo/logo-main.png"
                        alt="Brand Logo"
                        loading="lazy"
                    /></a>
                    <p>
                      Pesco is an exciting International brand we provide high
                      quality cloths
                    </p>
                    <ul class="ct-info-list mb-30">
                      <li>
                        <i class="fas fa-envelope"></i>
                        <a href="mailto:info@mydomain.com">info@mydomain.com</a>
                      </li>
                      <li>
                        <i class="fas fa-phone-alt"></i>
                        <a href="mailto:info@mydomain.com">info@mydomain.com</a>
                      </li>
                    </ul>
                    <ul
                      class="social-link"
                      aria-label="Find us on social media"
                    >
                      <li class="social-label me-2">Find Us:</li>
                      <li>
                        <a
                          href="https://www.facebook.com/"
                          target="_blank"
                          aria-label="Visit us on Facebook"
                        >
                          <i class="fab fa-facebook-f" aria-hidden="true"></i>
                        </a>
                      </li>
                      <li>
                        <a
                          href="https://www.instagram.com/"
                          target="_blank"
                          aria-label="Visit us on Instagram"
                        >
                          <i class="fab fa-instagram" aria-hidden="true"></i>
                        </a>
                      </li>
                      <li>
                        <a
                          href="https://in.linkedin.com/"
                          target="_blank"
                          aria-label="Visit us on LinkedIn"
                        >
                          <i class="fab fa-linkedin-in" aria-hidden="true"></i>
                        </a>
                      </li>
                      <li>
                        <a
                          href="https://x.com/"
                          target="_blank"
                          aria-label="Visit us on X (Twitter)"
                        >
                          <i class="fab fa-twitter" aria-hidden="true"></i>
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-md-6 col-sm-6">
                <div
                  class="footer-widget footer-nav-widget mb-40"
                  data-aos="fade-up"
                  data-aos-delay="15"
                  data-aos-duration="1200"
                >
                  <div class="widget-content">
                    <h4 class="widget-title">Customer Services</h4>
                    <ul class="widget-menu">
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="shops.html">Collections & Delivery</a>
                      </li>
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="shops.html">Returns & Refunds</a>
                      </li>
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="shops.html">Terms & Conditions</a>
                      </li>
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="shops.html">Delivery Return</a>
                      </li>
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="shops.html">Store Locations</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-md-6 col-sm-6">
                <div
                  class="footer-widget footer-nav-widget mb-40"
                  data-aos="fade-up"
                  data-aos-delay="20"
                  data-aos-duration="1400"
                >
                  <div class="widget-content">
                    <h4 class="widget-title">Quick Link</h4>
                    <ul class="widget-menu">
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="shops.html">Privacy Policy</a>
                      </li>
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="shops.html">Terms Of Use</a>
                      </li>
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="faq.html">FAQ</a>
                      </li>
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="contact.html">Contact</a>
                      </li>
                      <li>
                        <img
                          src="assets/images/icon/star-3.svg"
                          alt="star icon"
                          loading="lazy"
                        /><a href="contact.html">Login / Register</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="col-xl-3 col-sm-6">
                <div
                  class="footer-widget footer-recent-post-widget"
                  data-aos="fade-up"
                  data-aos-delay="25"
                  data-aos-duration="1600"
                >
                  <h4 class="widget-title">Recent Post</h4>
                  <div class="widget-content" id="recent-posts-container"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright-area">
          <div class="container">
            <div class="row align-items-center">
              <div class="col-lg-6">
                <div class="copyright-text">
                  <p>
                    &copy; 2025. All rights reserved by <span>Pixelfit</span>
                  </p>
                </div>

                <script>
                  document.addEventListener("DOMContentLoaded", () => {
                    const p = document.querySelector(".copyright-text p");
                    if (!p) return;
                    p.innerHTML = p.innerHTML.replace(
                      /\b\d{4}\b/,
                      new Date().getFullYear()
                    );
                  });
                </script>
              </div>
              <div class="col-lg-6">
                <div class="payment-method text-lg-end">
                  <a href="index.html"
                    ><img
                      src="assets/images/footer/payment-method.png"
                      alt="payment-method"
                      loading="lazy"
                  /></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        function formatDate(dateStr) {
          const date = new Date(dateStr);
          return date.toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });
        }

        function slugify(text) {
          return String(text || "")
            .toLowerCase()
            .trim()
            .replace(/[^a-z0-9\s-]/g, "")
            .replace(/\s+/g, "-");
        }

        fetch("/api/blogpostdata")
          .then((response) => {
            if (!response.ok) throw new Error("Failed to fetch blog data.");
            return response.json();
          })
          .then((data) => {
            data.sort((a, b) => new Date(b.date) - new Date(a.date));
            const topPosts = data.slice(0, 3);

            const container = document.getElementById("recent-posts-container");
            if (!container) return;

            container.innerHTML = "";
            topPosts.forEach((post) => {
              const slug = post.slug ? post.slug : slugify(post.name);

              const postHTML = `
            <div class="recent-post-item">
              <div class="thumb">
                <a href="/blog-details/${encodeURIComponent(
                  slug
                )}" class="w-100 h-100">
                  <img src="/api/uploads/${post.image}" alt="${post.name}" />
                </a>
              </div>
              <div class="content">
                <h4>
                  <a href="/blog-details/${encodeURIComponent(slug)}">${
                post.name
              }</a>
                </h4>
                <span>
                  <a href="/blog-details/${encodeURIComponent(
                    slug
                  )}">${formatDate(post.date)}</a>
                </span>
              </div>
            </div>
          `;
              container.insertAdjacentHTML("beforeend", postHTML);
            });
          })
          .catch((error) => {
            console.error("Error loading blog posts:", error);
          });
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const searchForm = document.querySelector(
          ".product-search-category form"
        );
        const searchInput = searchForm.querySelector('input[type="text"]');

        const dropdown = document.createElement("div");
        dropdown.className = "header-search-autocomplete";
        Object.assign(dropdown.style, {
          position: "absolute",
          top: "100%",
          left: 0,
          right: 0,
          background: "#fff",
          border: "1px solid #ddd",
          zIndex: 1000,
          maxHeight: "300px",
          overflowY: "auto",
          display: "none",
        });
        searchForm.style.position = "relative";
        searchForm.appendChild(dropdown);

        searchForm.addEventListener("submit", (e) => {
          e.preventDefault();
          window.location.href = "/shops-grid";
        });

        let timer;
        searchInput.addEventListener("input", () => {
          clearTimeout(timer);
          const q = searchInput.value.trim();
          if (q.length < 2) {
            dropdown.style.display = "none";
            return;
          }
          timer = setTimeout(() => {
            fetch("/api/productpagedata")
              .then((r) => r.json())
              .then((products) => {
                const matches = products
                  .filter((p) => p.name.toLowerCase().includes(q.toLowerCase()))
                  .slice(0, 5);

                if (!matches.length) {
                  dropdown.innerHTML = `<div style="padding:10px;color:#666">No matching products found at this time.</div>`;
                } else {
                  dropdown.innerHTML =
                    matches
                      .map((p) => {
                        const priceHTML = p.price_sale
                          ? `<strong style="color:#000">${p.price}</strong> <del style="color:#999" class="text-secondary fw-bold ms-2">${p.price_sale}</del>`
                          : `<strong class="text-secondary fw-bold" style="color:#000">${p.price}</strong>`;

                        return `
                <div class="autocomplete-item" data-name="${(
                  p.name || ""
                ).replace(
                  /"/g,
                  "&quot;"
                )}" style="display:flex;align-items:center;padding:8px;cursor:pointer;border-bottom:1px solid #eee">
                  <img src="/api/uploads/${p.image}" 
                      alt="${(p.name || "").replace(/"/g, "&quot;")}" 
                      style="width:40px;height:40px;object-fit:cover;margin-right:10px;">
                  <div>
                    <div style="font-weight:600;color:#333" class="text-dark fw-bold">${
                      p.name
                    }</div>
                    <div style="font-size:0.85em;margin-top:4px;">${priceHTML}</div>
                  </div>
                </div>
              `;
                      })
                      .join("") +
                    `<div class="autocomplete-show-all" style="padding:10px;text-align:center;color:#e74c3c;font-weight:600;cursor:pointer">
                  Show all results
                </div>`;
                }
                dropdown.style.display = "block";
              })
              .catch(() => {
                dropdown.innerHTML = `<div style="padding:10px;color:red;">Error loading results.</div>`;
                dropdown.style.display = "block";
              });
          }, 300);
        });

        dropdown.addEventListener("click", (e) => {
          const item = e.target.closest(".autocomplete-item");
          if (item) {
            window.location.href = "/shops-grid";
            return;
          }
          if (e.target.closest(".autocomplete-show-all")) {
            window.location.href = "/shops-grid";
          }
        });

        document.addEventListener("click", (e) => {
          if (!searchForm.contains(e.target)) {
            dropdown.style.display = "none";
          }
        });
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const res = await fetch("/api/get-theme-logo");
          if (!res.ok) throw new Error("Failed to fetch logo data");

          const data = await res.json();
          const logoUrl = data.logo_url;
          if (!logoUrl) throw new Error("Logo URL not found in API response");

          const highResLogo = `/api/uploads/${logoUrl}`;

          const logoImgs = [
            ...document.querySelectorAll(".brand-logo img"),
            ...document.querySelectorAll(".site-branding .brand-logo img"),
            ...document.querySelectorAll(".footer-logo img"),
          ];

          const preload = new Image();
          preload.onload = () => {
            logoImgs.forEach((img) => {
              img.src = highResLogo;
              img.alt = data.alt_text || "Logo";

              img.removeAttribute("width");
              img.removeAttribute("height");
              img.removeAttribute("style");
              img.removeAttribute("srcset");
            });
          };

          preload.onerror = () => {
            logoImgs.forEach((img) => {
              img.src = "assets/images/logo/logo-main.png";
              img.alt = "Logo";
              img.removeAttribute("width");
              img.removeAttribute("height");
              img.removeAttribute("style");
              img.removeAttribute("srcset");
            });
          };

          preload.src = highResLogo;
        } catch (error) {
          console.error("Logo load error:", error);
          const logoImgs = [
            ...document.querySelectorAll(".brand-logo img"),
            ...document.querySelectorAll(".site-branding .brand-logo img"),
            ...document.querySelectorAll(".footer-logo img"),
          ];
          logoImgs.forEach((img) => {
            img.src = "assets/images/logo/logo-main.png";
            img.alt = "Logo";
            img.removeAttribute("width");
            img.removeAttribute("height");
            img.removeAttribute("style");
            img.removeAttribute("srcset");
          });
        }
      });
    </script>

    <div class="back-to-top"><i class="far fa-angle-up"></i></div>
    <script src="assets/vendor/jquery-3.7.1.min.js" defer></script>
    <!-- <script src="assets/vendor/popper/popper.min.js" defer></script> -->
    <script src="assets/vendor/bootstrap/js/bootstrap.min.js" defer></script>
    <script src="assets/vendor/slick/slick.min.js" defer></script>
    <!-- <script
      src="assets/vendor/magnific-popup/dist/jquery.magnific-popup.min.js"
      defer
    ></script> -->
    <script
      src="assets/vendor/nice-select/js/jquery.nice-select.min.js"
      defer
    ></script>
    <script src="assets/vendor/jquery-ui/jquery-ui.min.js" defer></script>
    <script src="assets/vendor/simplyCountdown.min.js" defer></script>
    <script src="assets/vendor/aos/aos.js" defer></script>
    <script src="assets/js/theme.js" defer></script>
  </body>
</html>
