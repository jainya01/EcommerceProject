<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Explore detailed information about our top-quality products. Buy online with secure checkout and fast delivery at Roiser."
    />
    <title>Product Details - Buy Quality Products Online | Roiser</title>
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="assets/img/favicon.png"
    />
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/fontawesome.min.css" />
    <link rel="stylesheet" href="assets/css/venobox.min.css" />
    <link rel="stylesheet" href="assets/css/odometer.min.css" />
    <link rel="stylesheet" href="assets/css/nice-select.css" />
    <link rel="stylesheet" href="assets/css/swiper.min.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document
          .querySelectorAll("a[href$='.html']:not(.lang-btn)")
          .forEach((a) => {
            const href = a.getAttribute("href");
            const page = href.replace(/\.html$/, "");
            if (page === "index" || page === "") {
              a.setAttribute("href", "http://localhost:5173/");
            } else {
              a.setAttribute("href", `http://localhost:5173/${page}`);
            }
            a.addEventListener("click", (e) => {
              e.preventDefault();
              if (page === "index" || page === "") {
                window.parent.location.href = "http://localhost:5173/";
              } else {
                window.parent.location.href = `http://localhost:5173/${page}`;
              }
            });
          });
        document.querySelectorAll('a[href="#"]').forEach((a) => {
          a.addEventListener("click", (e) => e.preventDefault());
        });
      });
    </script>
  </head>

  <style>
    .product-details-wrap,
    .product-details {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .row.equal-height {
      display: flex;
      align-items: stretch;
    }

    .product-slider-wrap,
    .product-details {
      flex: 1;
    }

    .thumb-item {
      cursor: pointer;
    }

    .right-content {
      height: 220px;
      max-width: 535px;
      width: 100%;
      object-fit: contain;
      background-color: rgb(33, 108, 173);
    }

    .right-content img {
      height: 220px;
      max-width: 535px;
      width: 100%;
      object-fit: cover;
      overflow: hidden;
    }

    #star-rating li i {
      color: #e53e3e;
      cursor: pointer;
    }

    .review-list .review-item {
      display: flex;
      margin-bottom: 1.5rem;
    }
    .review-list .review-thumb img {
      width: 64px;
      height: 64px;
      object-fit: cover;
      border-radius: 4px;
    }

    .review-list .content {
      margin-left: 1rem;
    }

    .review-list .content-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .review-list .review {
      display: flex;
      gap: 0.25rem;
      margin: 0.25rem 0;
    }
    .review-list .review li i {
      color: #ccc;
    }
    .review-list .review li.filled i {
      color: #e53e3e;
    }
  </style>

  <body>
    <header class="header sticky-active">
      <div class="top-bar">
        <div class="container">
          <div class="top-bar-inner">
            <div class="top-bar-left">
              <ul class="top-left-list">
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">My Account</a></li>
                <li><a href="wishlist.html">Wishlist</a></li>
                <li><a href="checkout.html">Checkout</a></li>
              </ul>
            </div>
            <div class="top-bar-middle">
              <span
                id="announcement-text"
                style="
                  display: inline-block;
                  transition: transform 0.5s ease;
                  white-space: nowrap;
                "
              ></span>
            </div>

            <div class="top-bar-right">
              <ul class="top-right-list">
                <li><a href="contact.html">Store Location</a></li>
                <li>
                  <div class="nice-select select-control country1" tabindex="0">
                    <span class="current">Language</span>
                    <ul class="list">
                      <li data-value="" class="option selected focus">
                        Language
                      </li>
                      <li data-value="vdt" class="option">English</li>
                      <li data-value="can" class="option">Bangla</li>
                      <li data-value="uk" class="option">Arabic</li>
                    </ul>
                  </div>
                </li>
                <li>
                  <div
                    class="nice-select select-control select-2 country"
                    tabindex="0"
                  >
                    <span class="current">Currency</span>
                    <ul class="list">
                      <li data-value="" class="option selected focus">
                        Currency
                      </li>
                      <li data-value="vdt" class="option">Doller</li>
                      <li data-value="can" class="option">Rupee</li>
                      <li data-value="uk" class="option">Taka</li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="header-middle">
        <div class="container">
          <div class="header-middle-inner">
            <div class="header-middle-left">
              <div class="header-logo d-lg-block">
                <a href="index.html">
                  <img
                    src="assets/img/logo/logo-1.png"
                    alt="Logo"
                    loading="lazy"
                    id="site-logo"
                  />
                </a>
              </div>
              <div class="category-form-wrap">
                <div class="nice-select select-control country" tabindex="0">
                  <span class="current">ALL Categories</span>
                  <ul class="list">
                    <li data-value="" class="option selected focus">
                      ALL Categories
                    </li>
                    <li data-value="vdt" class="option">Fashion</li>
                    <li data-value="can" class="option">Organic</li>
                    <li data-value="uk" class="option">Furniture</li>
                  </ul>
                </div>

                <form class="header-form">
                  <input
                    class="form-control"
                    type="text"
                    name="search"
                    placeholder="Search here..."
                    required
                  />
                  <button class="submit rr-primary-btn" type="submit">
                    Search here
                  </button>
                </form>
              </div>
            </div>
            <div class="header-middle-right">
              <ul class="contact-item-list">
                <li>
                  <div class="content">
                    <span>Call Us Now:</span>
                    <a class="number" href="tel:+25821592159"
                      >+(258) 2159-2159</a
                    >
                  </div>
                  <a href="tel:+25821592159" class="icon" aria-label="Call us">
                    <i class="fa-regular fa-phone"></i>
                  </a>
                </li>
                <li>
                  <a
                    href="wishlist.html"
                    class="icon"
                    aria-label="View wishlist"
                  >
                    <i class="fa-sharp fa-regular fa-heart"></i>
                  </a>
                </li>
                <li>
                  <a href="cart.html" class="icon" aria-label="View cart">
                    <i class="fa-light fa-bag-shopping"></i>
                    <span>0</span>
                  </a>
                  <div class="content">
                    <span>Your cart,</span>
                    <h5 class="number">$0.00</h5>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="primary-header">
        <div class="container">
          <div class="primary-header-inner">
            <div class="header-logo mobile-logo">
              <a href="index.html">
                <img
                  src="assets/img/logo/logo-1.png"
                  alt="Logo"
                  loading="lazy"
                />
              </a>
            </div>
            <div class="header-menu-wrap">
              <div class="mobile-menu-items">
                <ul>
                  <li class="menu-item-has-children active">
                    <a href="index.html">Home</a>
                    <ul>
                      <li><a href="index.html">Fashion Home</a></li>
                      <li><a href="index-2.html">Grocery Home</a></li>
                      <li><a href="index-3.html">Furniture</a></li>
                    </ul>
                  </li>
                  <li class="menu-item-has-children">
                    <a href="shop.html">Shop</a>
                    <ul>
                      <li><a href="shop.html">Shop</a></li>
                      <li><a href="shop-grid.html">Shop Grid</a></li>
                      <li><a href="shop-details.html">Shop Details</a></li>
                      <li><a href="cart.html">Cart</a></li>
                      <li><a href="wishlist.html">Wishlist</a></li>
                      <li><a href="checkout.html">Checkout</a></li>
                    </ul>
                  </li>
                  <li>
                    <a href="shop-grid.html">Women</a>
                  </li>
                  <li>
                    <a href="shop-grid.html">men</a>
                  </li>
                  <li class="menu-item-has-children">
                    <a href="/about">Pages</a>
                    <ul>
                      <li><a href="about.html">About</a></li>
                      <li><a href="login.html">Login</a></li>
                      <li><a href="register.html">Register</a></li>
                      <li><a href="faq.html">Faq</a></li>
                      <li><a href="error.html">404 Error</a></li>
                    </ul>
                  </li>
                  <li class="menu-item-has-children">
                    <a href="blog-grid.html">Blog</a>
                    <ul>
                      <li><a href="blog-grid.html">Blog Grid</a></li>
                      <li><a href="blog-list.html">Blog list</a></li>
                      <li><a href="blog-details.html">Blog Details</a></li>
                    </ul>
                  </li>
                  <li><a href="contact.html">Contact</a></li>
                </ul>
              </div>
            </div>
            <div class="header-right-wrap">
              <div class="header-right">
                <span>Get 30% Discount Now <span>Sale</span></span>
                <div class="header-right-item">
                  <button
                    class="mobile-side-menu-toggle"
                    aria-label="Toggle mobile menu"
                    type="button"
                  >
                    <i class="fa-sharp fa-solid fa-bars" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div id="popup-search-box">
      <div class="box-inner-wrap d-flex align-items-center">
        <form id="form" action="#" method="get" role="search">
          <input
            id="popup-search"
            type="text"
            name="search"
            placeholder="Type keywords here..."
          />
        </form>
        <div class="search-close">
          <i class="fa-sharp fa-regular fa-xmark"></i>
        </div>
      </div>
    </div>

    <div class="mobile-side-menu">
      <div class="side-menu-content">
        <div class="side-menu-head">
          <a href="index.html"
            ><img src="assets/img/logo/logo-1.png" alt="logo" loading="lazy"
          /></a>
          <button class="mobile-side-menu-close">
            <i class="fa-regular fa-xmark"></i>
          </button>
        </div>
        <div class="side-menu-wrap"></div>
        <ul class="side-menu-list">
          <li>
            <i class="fa-light fa-location-dot"></i>Address :
            <span>Amsterdam, 109-74</span>
          </li>
          <li>
            <i class="fa-light fa-phone"></i>Phone :
            <a href="tel:+01569896654">+01 569 896 654</a>
          </li>
          <li>
            <i class="fa-light fa-envelope"></i>Email :
            <a href="mailto:info@example.com">info@example.com</a>
          </li>
        </ul>
      </div>
    </div>

    <div id="preloader">
      <div class="preloader-close">X</div>
      <div class="sk-three-bounce">
        <div class="sk-child sk-bounce1"></div>
        <div class="sk-child sk-bounce2"></div>
        <div class="sk-child sk-bounce3"></div>
      </div>
    </div>

    <section class="page-header">
      <div class="shape">
        <img
          src="assets/img/shapes/page-header-shape.png"
          alt="shape"
          loading="lazy"
        />
      </div>
      <div class="container">
        <div class="page-header-content">
          <h1 class="title">Shop Details</h1>
          <h2 class="sub-title">
            <span class="home">
              <a href="#">
                <span>Home</span>
              </a>
            </span>
            <span class="icon"><i class="fa-solid fa-angle-right"></i></span>
            <span class="inner">
              <span>Shop Details</span>
            </span>
          </h2>
        </div>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const res = await fetch("/api/get-theme-breadcrumb");
          const config = await res.json();

          const section = document.querySelector(".page-header");
          const content = section.querySelector(".page-header-content");
          const titleEl = content.querySelector(".title");
          const crumbEl = content.querySelector(".sub-title");
          const imgEl = section.querySelector(".shape img");

          if (config.enable_breadcrumb === "no") {
            titleEl.style.display = "none";
            crumbEl.style.display = "none";
          } else {
            titleEl.style.display = "";
            crumbEl.style.display = "";
          }

          if (config.breadcrumb_height) {
            section.style.height = config.breadcrumb_height + "px";
          }

          if (config.background_color) {
            section.style.backgroundColor = config.background_color;
          }

          if (config.background_image && config.background_image.trim()) {
            const bg = config.background_image.trim();
            imgEl.src = bg.startsWith("http") ? bg : `/api/${bg}`;
          }

          if (
            config.enable_breadcrumb === "yes" &&
            config.hide_title === "yes"
          ) {
            titleEl.style.display = "none";
          }

          if (config.enable_breadcrumb === "yes") {
            switch (config.breadcrumb_style) {
              case "none":
                crumbEl.style.display = "none";
                break;
              case "align center":
                content.style.textAlign = "center";
                break;
              default:
                content.style.textAlign = "start";
            }
          }
        } catch (e) {
          console.error("Breadcrumb config failed to load:", e);
        }
      });
    </script>

    <section class="shop-section single pt-100 pb-100">
      <div class="container">
        <div class="row equal-height">
          <div class="col-lg-6 product-details-wrap">
            <div class="product-slider-wrap">
              <div class="swiper product-gallary-thumb">
                <div class="swiper-wrapper" id="product-thumbs"></div>
              </div>

              <div class="swiper product-gallary">
                <span class="sale" id="product-label">Sale</span>
                <div class="swiper-wrapper" id="product-gallery"></div>

                <div class="swiper-nav-next">
                  <i class="las la-arrow-right"></i>
                </div>

                <div class="swiper-nav-prev">
                  <i class="las la-arrow-left"></i>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="product-details">
              <div class="product-info">
                <div class="product-inner">
                  <span class="category" id="product-brand">Brand Name</span>
                  <h2 class="title" id="product-title">Product Title</h2>

                  <div class="rating-wrap">
                    <ul class="rating gap-1">
                      <li>
                        <i class="fa-sharp fa-solid fa-star text-danger"></i>
                      </li>
                      <li>
                        <i class="fa-sharp fa-solid fa-star text-danger"></i>
                      </li>
                      <li>
                        <i class="fa-sharp fa-solid fa-star text-danger"></i>
                      </li>
                      <li>
                        <i class="fa-sharp fa-solid fa-star text-danger"></i>
                      </li>
                      <li>
                        <i class="fa-sharp fa-solid fa-star text-danger"></i>
                      </li>
                    </ul>
                    <span class="contact-tabs">(2 customer review)</span>
                  </div>

                  <h3 class="price">
                    <span id="product-price" class="text-dark fw-bold"
                      >$0.00</span
                    >
                    <span id="product-sale-price" class="text-decoration-none"
                      >$0.00</span
                    >
                  </h3>

                  <div class="product-desc-wrap">
                    <p class="desc" id="product-desc">Description loading...</p>
                    <span class="view-text">
                      <i class="fa-sharp fa-regular fa-eye"></i>28 people are
                      viewing this right now
                    </span>
                  </div>

                  <div class="item-left-line">
                    <span id="product-stock">Only 15 items left in stock!</span>
                    <div class="line"></div>
                  </div>

                  <ul class="details-list">
                    <li>
                      <i class="fa-light fa-arrow-right-arrow-left"></i>Free
                      returns
                    </li>
                    <li>
                      <i class="fa-light fa-truck"></i>Free shipping via DHL,
                      fully insured
                    </li>
                    <li>
                      <i class="fa-light fa-circle-check"></i>All taxes and
                      customs duties included
                    </li>
                  </ul>
                </div>

                <div class="product-btn">
                  <form>
                    <input
                      type="number"
                      name="age"
                      id="age"
                      min="1"
                      max="100"
                      step="1"
                      value="1"
                    />
                  </form>
                  <div class="cart-btn-wrap-2">
                    <a href="#" class="rr-primary-btn cart-btn">Add To Cart</a>
                  </div>
                </div>

                <a href="cart.html" class="shop-details-btn rr-primary-btn"
                  >Buy The Item Now</a
                >

                <ul class="product-meta">
                  <li><a href="#">Compare</a></li>
                  <li><a href="#">Ask a question</a></li>
                  <li><a href="#">Share</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="product-description pb-100">
      <div class="container">
        <ul
          class="nav tab-navigation"
          id="product-tab-navigation"
          role="tablist"
        >
          <li role="presentation">
            <button
              class="active"
              id="home-tab"
              data-bs-toggle="tab"
              data-bs-target="#home"
              type="button"
              role="tab"
              aria-controls="home"
              aria-selected="true"
            >
              Description
            </button>
          </li>
          <li role="presentation">
            <button
              id="profile-tab"
              data-bs-toggle="tab"
              data-bs-target="#profile"
              type="button"
              role="tab"
              aria-controls="profile"
              aria-selected="false"
            >
              Additional information
            </button>
          </li>

          <li role="presentation">
            <button
              class="contact-tab"
              data-bs-toggle="tab"
              data-bs-target="#contact"
              type="button"
              role="tab"
              aria-controls="contact"
              aria-selected="false"
            >
              Reviews()
            </button>
          </li>
        </ul>

        <div class="tab-content" id="product-tab-content">
          <div
            class="tab-pane fade show active description"
            id="home"
            role="tabpanel"
            aria-labelledby="home-tab"
          >
            <div class="desc-wrap">
              <div class="left-content">
                <p class="mb-30" id="product-desc1">Description loading</p>
              </div>
              <div class="right-content border" id="product-gallery1"></div>
            </div>
          </div>

          <div
            class="tab-pane fade"
            id="profile"
            role="tabpanel"
            aria-labelledby="profile-tab"
          >
            <table class="table product-table">
              <thead>
                <tr>
                  <th scope="col">Size</th>
                  <th scope="col">Bust</th>
                  <th scope="col">Waist</th>
                  <th scope="col">Hip</th>
                </tr>
              </thead>
              <tbody id="product-size-table-body"></tbody>
            </table>
          </div>

          <div
            class="tab-pane fade review"
            id="contact"
            role="tabpanel"
            aria-labelledby="contact-tab"
          >
            <div class="row product-review gy-lg-0 gy-4">
              <div class="col-lg-5 col-md-12">
                <div class="reviewr-wrap">
                  <div class="review-list" id="review-list"></div>
                </div>
              </div>

              <div class="col-lg-7 col-md-12">
                <div class="review-form-wrap">
                  <h4 class="title">Review this product</h4>
                  <span class="publish">
                    Your email address will not be published. Required fields
                    are marked *
                  </span>
                  <div class="review-box">
                    <span>Your ratings :</span>
                    <ul
                      id="star-rating"
                      style="
                        list-style: none;
                        padding: 0;
                        margin: 0;
                        display: flex;
                        flex-direction: row-reverse;
                        gap: 0.5rem;
                      "
                    >
                      <li data-index="1">
                        <i class="fa-sharp fa-solid fa-star"></i>
                      </li>
                      <li data-index="2">
                        <i class="fa-sharp fa-solid fa-star"></i>
                      </li>
                      <li data-index="3">
                        <i class="fa-sharp fa-solid fa-star"></i>
                      </li>
                      <li data-index="4">
                        <i class="fa-sharp fa-solid fa-star"></i>
                      </li>
                      <li data-index="5">
                        <i class="fa-sharp fa-solid fa-star"></i>
                      </li>
                    </ul>
                  </div>

                  <div class="blog-contact-form form-2 review-form">
                    <div class="request-form">
                      <form class="form-horizontal">
                        <input
                          type="hidden"
                          name="star"
                          id="rating-value"
                          value="0"
                        />

                        <div class="form-group row">
                          <div class="col-md-12">
                            <div class="form-item">
                              <input
                                type="text"
                                id="user_name"
                                name="user_name"
                                class="form-control py-4"
                                placeholder="Your Name"
                                required
                              />
                            </div>
                          </div>
                          <div class="col-md-12">
                            <div class="form-item">
                              <input
                                type="email"
                                id="email"
                                name="email"
                                class="form-control py-4"
                                placeholder="Your Email"
                                required
                              />
                            </div>
                          </div>
                        </div>

                        <div class="form-group row">
                          <div class="col-md-12">
                            <div class="form-item message-item">
                              <textarea
                                id="comment"
                                name="comment"
                                cols="30"
                                rows="5"
                                class="form-control address"
                                placeholder="Comment"
                                required
                                style="height: 100px"
                              ></textarea>
                            </div>
                          </div>
                        </div>

                        <div class="checkbox-wrap">
                          <input
                            type="checkbox"
                            id="save-info"
                            name="save_info"
                            value="1"
                            required
                          />
                          <label for="save-info">
                            Save my name, email, and website in this browser for
                            the next time I comment.
                          </label>
                        </div>

                        <div class="submit-btn">
                          <button
                            id="submit"
                            class="rr-primary-btn"
                            type="submit"
                          >
                            Submit
                          </button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const userId = localStorage.getItem("user_id");

        function updateCartIcon() {
          if (!userId) return;

          fetch(`/api/allcartdata?user_id=${userId}`)
            .then((res) => res.json())
            .then((data) => {
              let totalItems = 0;
              let totalAmount = 0;
              const seen = new Set();

              if (Array.isArray(data) && data.length > 0) {
                data.forEach((item) => {
                  const name = item.name;
                  if (seen.has(name)) {
                    return;
                  }
                  seen.add(name);

                  const quantity = parseInt(item.quantity || 1, 10);
                  const price = parseFloat(
                    (item.price || "").replace("$", "") || 0
                  );

                  totalItems += quantity;
                  totalAmount += quantity * price;
                });
              }

              document.querySelector(".icon span").innerText = totalItems;
              document.querySelector(
                ".content h5.number"
              ).innerText = `$${totalAmount.toFixed(2)}`;
            })
            .catch((err) => {
              console.error("Error updating cart info:", err);
            });
        }

        function stripTags(html) {
          const tmp = document.createElement("div");
          tmp.innerHTML = html;
          return tmp.textContent || tmp.innerText || "";
        }

        function updateAnnouncements() {
          fetch("/api/getannounce")
            .then((res) => res.json())
            .then((data) => {
              if (!data || !data.length) return;

              const today = new Date();
              const validAnnouncements = data.filter(
                (item) =>
                  item.active === "yes" && new Date(item.end_date) >= today
              );
              if (!validAnnouncements.length) return;

              const limitWords = (text, limit = 6) => {
                const words = text.trim().split(/\s+/);
                return (
                  words.slice(0, limit).join(" ") +
                  (words.length > limit ? "..." : "")
                );
              };

              const messages = validAnnouncements.map((item) =>
                limitWords(stripTags(item.content))
              );

              const announcer = document.getElementById("announcement-text");
              let index = 0;

              const rotate = () => {
                announcer.style.transform = "translateY(-100%)";
                setTimeout(() => {
                  announcer.textContent = messages[index];
                  announcer.style.transform = "translateY(0)";
                  index = (index + 1) % messages.length;
                }, 300);
              };

              announcer.textContent = messages[index];
              index++;
              setInterval(rotate, 3000);
            })
            .catch((err) => {
              console.error("Error fetching announcement:", err);
            });
        }

        updateCartIcon();
        setInterval(updateCartIcon, 1000);
        updateAnnouncements();
      });

      function getUserId() {
        return localStorage.getItem("user_id") || null;
      }
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let selectedCurrency = localStorage.getItem("currency") || "vdt";

        const currencyRates = {
          vdt: { symbol: "$", rate: 1 },
          can: { symbol: "₹", rate: 83 },
          uk: { symbol: "৳", rate: 108 },
        };

        const currentCurrency = currencyRates[selectedCurrency];
        if (currentCurrency) {
          const selectedOption = document.querySelector(
            `.nice-select.country .option[data-value="${selectedCurrency}"]`
          );
          if (selectedOption) {
            document.querySelector(
              ".nice-select.country .current"
            ).textContent = selectedOption.textContent;
          }
        }

        document
          .querySelectorAll(".nice-select.country .option")
          .forEach((opt) => {
            opt.addEventListener("click", () => {
              const code = opt.dataset.value;
              if (currencyRates[code]) {
                selectedCurrency = code;
                localStorage.setItem("currency", selectedCurrency);
                document.querySelector(
                  ".nice-select.country .current"
                ).textContent = opt.textContent;
              }
            });
          });

        function formatPrice(raw) {
          const n = parseFloat(raw.replace(/[^0-9.]/g, "")) || 0;
          const { symbol, rate } = currencyRates[selectedCurrency];
          return symbol + (n * rate).toFixed(2);
        }

        const wrapper = document.querySelector(".category-form-wrap");
        wrapper.style.position = "relative";

        const resultBox = document.createElement("div");
        resultBox.classList.add("search-result-dropdown");
        Object.assign(resultBox.style, {
          position: "absolute",
          top: "100%",
          left: "0%",
          width: "100%",
          background: "#fff",
          border: "1px solid #ddd",
          zIndex: "1000",
          maxHeight: "300px",
          overflowY: "auto",
          display: "none",
        });
        wrapper.appendChild(resultBox);

        const searchInput = wrapper.querySelector('input[name="search"]');
        let timeout;

        searchInput.addEventListener("input", () => {
          const q = searchInput.value.trim();
          clearTimeout(timeout);

          if (q.length < 2) {
            resultBox.style.display = "none";
            resultBox.innerHTML = "";
            return;
          }

          timeout = setTimeout(() => {
            fetch("/api/productpagedata")
              .then((r) => r.json())
              .then((products) => {
                const matches = products
                  .filter((p) => p.name.toLowerCase().includes(q.toLowerCase()))
                  .slice(0, 5);

                if (!matches.length) {
                  resultBox.innerHTML = `<div style="padding:10px;color:#666">No matching products found at this time.</div>`;
                } else {
                  resultBox.innerHTML =
                    matches
                      .map((p) => {
                        const img = (p.image || "").split(",")[0].trim();
                        const mainPrice = formatPrice(p.price);

                        const salePrice = p.price_sale
                          ? `<strong class="text-dark me-2">${formatPrice(
                              p.price
                            )}</strong>
                              <s class="fw-bold text-danger">${formatPrice(
                                p.price_sale
                              )}</s>`
                          : `<strong class="fw-bold text-dark">${formatPrice(
                              p.price
                            )}</strong>`;

                        return `
                    <div
                     onclick="window.location.href='/shop-details/${p.slug}'"
                      style="cursor:pointer;display:flex;align-items:center;padding:8px 10px;border-bottom:1px solid #eee;"
                    >
                      <img src="/api/uploads/${img}" alt="${p.name}"
                          style="width:40px;height:40px;object-fit:cover;margin-right:10px;">
                      <div>
                        <div class="fw-bold text-dark">${p.name}</div>
                        <div style="font-size:0.85em;color:#999;">
                          ${salePrice}
                        </div>
                      </div>
                    </div>
                  `;
                      })
                      .join("") +
                    `
                  <div
                    onclick="window.location.href='/shop-details/${p.slug}'"
                    style="padding:10px;text-align:center;color:#e74c3c;font-weight:600;cursor:pointer;"
                  >
                    Show all results
                  </div>
                `;
                }

                resultBox.style.display = "block";
              })
              .catch((err) => {
                console.error("Error fetching products:", err);
                resultBox.innerHTML = `<div style="padding:10px;color:red;">Error loading results.</div>`;
                resultBox.style.display = "block";
              });
          }, 300);
        });

        document.addEventListener("click", (e) => {
          if (!wrapper.contains(e.target)) {
            resultBox.style.display = "none";
          }
        });
      });
    </script>

    <!-- <script>
      document.addEventListener("DOMContentLoaded", async () => {
        let currentProduct = null;
        const productBrand = document.getElementById("product-brand");
        const productTitle = document.getElementById("product-title");
        const productPrice = document.getElementById("product-price");
        const productSale = document.getElementById("product-sale-price");
        const productDesc = document.getElementById("product-desc");
        const productDesc1 = document.getElementById("product-desc1");
        const productLabel = document.getElementById("product-label");
        const galleryMain = document.getElementById("product-gallery");
        const gallerySide = document.getElementById("product-gallery1");
        const thumbWrapper = document.getElementById("product-thumbs");
        const productStock = document.getElementById("product-stock");
        const sizeBody = document.getElementById("product-size-table-body");
        const cartBtn = document.querySelector(".cart-btn-wrap-2 .cart-btn");
        const qtyInput = document.getElementById("age");
        let products;

        function stripTags(html) {
          const tmp = document.createElement("div");
          tmp.innerHTML = html || "";
          return tmp.textContent || tmp.innerText || "";
        }

        try {
          const res = await fetch("/api/productpagedata");
          if (!res.ok) throw new Error("Failed to fetch products");
          products = await res.json();
        } catch (err) {
          console.error(err);
          showErrorBanner("Could not load products.");
          return;
        }

        if (!Array.isArray(products) || products.length === 0) {
          showErrorBanner("No products available.");
          return;
        }

        const requested = localStorage.getItem("selectedProductId");
        currentProduct = requested
          ? products.find((p) => String(p.id) === requested) || products[0]
          : products[0];
        localStorage.removeItem("selectedProductId");

        renderDetails(currentProduct);
        renderThumbs(products.slice(0, 3));

        window.selectedProductName = currentProduct.name;
        window.selectedProductImg = `${currentProduct.image}`;

        function renderDetails(p) {
          currentProduct = p;
          productBrand.textContent = p.brand || "N/A";
          productTitle.textContent = p.name || "";
          productPrice.textContent = p.price_sale || "";
          productSale.textContent = p.price || "";
          productDesc.textContent = stripTags(p.description);
          productDesc1.textContent = stripTags(p.description);
          productLabel.textContent = p.label || "";
          const stockCount = parseInt(p.minimumorder) || 0;
          productStock.textContent = `Only ${stockCount} items left in stock!`;

          const maxStock = 100;
          const percent = Math.min(
            Math.round((stockCount / maxStock) * 100),
            100
          );
          const lineBeforeStyleId = "dynamic-stock-line-style";
          const existingStyle = document.getElementById(lineBeforeStyleId);
          if (existingStyle) existingStyle.remove();

          const style = document.createElement("style");
          style.id = lineBeforeStyleId;
          style.innerHTML = `
          .item-left-line .line::before {
            background-color: #e53e3e !important;
            content: "";
            width: ${percent}% !important;
            height: 100% !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
          }
        `;
          document.head.appendChild(style);

          galleryMain.innerHTML = `
            <div class="swiper-slide">
              <div class="gallary-item">
                <img src="/api/uploads/${p.image}" alt="${p.name}"
                     style="width:100%;height:100%;object-fit:cover"/>
              </div>
            </div>`;

          gallerySide.innerHTML = `
            <div class="right-content"
                    <div class="gallary-item">
                      <img src="/api/uploads/${p.image}" alt="${p.name}" style="width: 100%; height: 100%; object-fit: cover;" />
                    </div>
                  </div>
                `;

          sizeBody.innerHTML = "";
          const attrs = (p.attribute || "").split(",").map((s) => s.trim());
          const map = {};
          attrs.forEach((pair) => {
            const [k, v] = pair.split(":").map((x) => x.trim());
            if (k && v) map[k.toLowerCase()] = v;
          });
          if (map.size || map.bust || map.waist || map.hip) {
            sizeBody.innerHTML = `
        <tr>
          <td>${(map.size || "--").toUpperCase()}</td>
          <td>${map.bust || "--"}</td>
          <td>${map.waist || "--"}</td>
          <td>${map.hip || "--"}</td>
        </tr>`;
          }

          if (cartBtn) cartBtn.setAttribute("data-id", p.id);
          window.selectedProductName = p.name;
          window.selectedProductImg = `${p.image}`;
        }

        function renderThumbs(arr) {
          thumbWrapper.innerHTML = "";
          arr.forEach((p) => {
            const d = document.createElement("div");
            d.className = "swiper-slide";
            d.innerHTML = `
        <div class="thumb-item">
          <img src="/api/uploads/${p.image}" alt="${p.name}"/>
        </div>`;
            d.addEventListener("click", () => renderDetails(p));
            thumbWrapper.appendChild(d);
          });
        }

        const user_id = localStorage.getItem("user_id");
        if (cartBtn && user_id) {
          cartBtn.addEventListener("click", async (e) => {
            e.preventDefault();
            const qty = parseInt(qtyInput.value, 10) || 1;
            const payload = {
              user_id,
              name: currentProduct.name,
              store: "default",
              price: currentProduct.price,
              price_sale: currentProduct.price_sale,
              image: currentProduct.image,
              quantity: qty,
            };
            try {
              const res = await fetch("/api/addcart", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });
              if (!res.ok) throw new Error("Add to cart failed");
              showSuccessBanner("Product added to cart!");
              cartBtn.innerHTML = `<i class="fa-solid fa-check"></i> Added!`;
              cartBtn.classList.add("added");
            } catch (err) {
              console.error(err);
              showErrorBanner("Failed to add to cart.");
            }
          });
        }

        const starList = document.getElementById("star-rating");
        starList.style.flexDirection = "row";
        const stars = Array.from(starList.querySelectorAll("li"));
        const ratingInput = document.getElementById("rating-value");
        let currentRating = 4;
        function paint(u) {
          stars.forEach((li) => {
            const i = +li.dataset.index;
            li.querySelector("i").style.color = i <= u ? "#E53E3E" : "#ccc";
          });
        }
        function renderStars() {
          paint(currentRating);
        }
        stars.forEach((li) => {
          const idx = +li.dataset.index;
          li.addEventListener("mouseover", () => paint(idx));
          li.addEventListener("mouseout", renderStars);
          li.addEventListener("click", () => {
            currentRating = idx;
            ratingInput.value = idx;
            renderStars();
          });
        });
        renderStars();

        const form = document.querySelector(".review-form-wrap form");
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          if (currentRating === 0) {
            showErrorBanner("Please select a star rating.");
            return;
          }
          const fd = new FormData(form);
          fd.append("product_name", window.selectedProductName);
          fd.append("product_image", window.selectedProductImg);

          try {
            const res = await fetch("/api/reviewdatasubmit", {
              method: "POST",
              body: fd,
            });
            if (!res.ok) {
              const t = await res.text();
              throw new Error(t || res.statusText);
            }
            showSuccessBanner("Review submitted successfully!");
            form.reset();
            currentRating = 0;
            ratingInput.value = 0;
            renderStars();
          } catch (err) {
            console.error(err);
            showErrorBanner("Failed to submit review.");
          }
        });

        function showSuccessBanner(msg) {
          const b = document.createElement("div");
          b.className = "alert alert-success";
          Object.assign(b.style, {
            position: "fixed",
            top: "20px",
            right: "20px",
            zIndex: 9999,
          });
          b.innerText = msg;
          document.body.appendChild(b);
          setTimeout(() => b.remove(), 3000);
        }
        function showErrorBanner(msg) {
          const b = document.createElement("div");
          b.className = "alert alert-danger";
          Object.assign(b.style, {
            position: "fixed",
            top: "20px",
            right: "20px",
            zIndex: 9999,
          });
          b.innerText = msg;
          document.body.appendChild(b);
          setTimeout(() => b.remove(), 3000);
        }
      });
    </script> -->

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        let currentProduct = null;
        const productBrand = document.getElementById("product-brand");
        const productTitle = document.getElementById("product-title");
        const productPrice = document.getElementById("product-price");
        const productSale = document.getElementById("product-sale-price");
        const productDesc = document.getElementById("product-desc");
        const productDesc1 = document.getElementById("product-desc1");
        const productLabel = document.getElementById("product-label");
        const galleryMain = document.getElementById("product-gallery");
        const gallerySide = document.getElementById("product-gallery1");
        const thumbWrapper = document.getElementById("product-thumbs");
        const productStock = document.getElementById("product-stock");
        const sizeBody = document.getElementById("product-size-table-body");
        const cartBtn = document.querySelector(".cart-btn-wrap-2 .cart-btn");
        const qtyInput = document.getElementById("age");
        let products;

        function stripTags(html) {
          const tmp = document.createElement("div");
          tmp.innerHTML = html || "";
          return tmp.textContent || tmp.innerText || "";
        }

        function toSeoUrl(str = "") {
          return String(str)
            .toLowerCase()
            .trim()
            .replace(/\s+/g, "-")
            .replace(/[^\w\-]+/g, "");
        }

        function getQueryParam(name) {
          const params = new URLSearchParams(window.location.search);
          return params.get(name);
        }

        function getUrlSlug() {
          try {
            const path = window.location.pathname || "";
            const segs = path.split("/").filter(Boolean);
            return segs.length ? decodeURIComponent(segs[segs.length - 1]) : "";
          } catch {
            return "";
          }
        }

        try {
          const res = await fetch("/api/productpagedata");
          if (!res.ok) throw new Error("Failed to fetch products");
          products = await res.json();
        } catch (err) {
          console.error(err);
          showErrorBanner("Could not load products.");
          return;
        }

        if (!Array.isArray(products) || products.length === 0) {
          showErrorBanner("No products available.");
          return;
        }

        // ensure each product has a slug and name
        products.forEach((p) => {
          if (!p) return;
          p.name =
            p.name ||
            "product-" + (p.id || Math.random().toString(36).slice(2, 8));
          p.slug =
            (p.slug && String(p.slug).trim()) ||
            toSeoUrl(p.name) ||
            String(p.id);
        });

        const lsRequested = localStorage.getItem("selectedProductId");
        const urlSlug = getUrlSlug();
        const qsProduct = getQueryParam("product") || getQueryParam("id") || "";
        let selected = null;

        if (lsRequested) {
          selected = products.find(
            (p) =>
              String(p.id) === String(lsRequested) ||
              String(p.slug) === String(lsRequested)
          );
        }

        if (!selected && urlSlug) {
          selected =
            products.find((p) => String(p.slug) === String(urlSlug)) ||
            products.find((p) => toSeoUrl(p.name) === String(urlSlug)) ||
            products.find((p) => String(p.id) === String(urlSlug));
        }

        if (!selected && qsProduct) {
          selected =
            products.find((p) => String(p.slug) === String(qsProduct)) ||
            products.find((p) => toSeoUrl(p.name) === String(qsProduct)) ||
            products.find((p) => String(p.id) === String(qsProduct));
        }

        if (!selected) selected = products[0];

        localStorage.removeItem("selectedProductId");

        currentProduct = selected;
        renderDetails(currentProduct);

        // helper: always return up to `limit` related products excluding selectedId
        // prefer previousId if available so the previous current stays visible after switching
        function getRelatedFor(selectedId, previousId, limit = 3) {
          const others = products.filter(
            (p) => String(p.id) !== String(selectedId)
          );
          if (others.length <= limit) return others.slice(0, limit);
          const result = [];
          if (previousId) {
            const prevIdx = others.findIndex(
              (p) => String(p.id) === String(previousId)
            );
            if (prevIdx !== -1) {
              result.push(others.splice(prevIdx, 1)[0]);
            }
          }
          for (let i = 0; i < others.length && result.length < limit; i++) {
            result.push(others[i]);
          }
          return result;
        }

        const initialRelated = getRelatedFor(currentProduct.id, null, 3);
        renderThumbs(initialRelated);

        window.selectedProductName = currentProduct.name;
        window.selectedProductImg = `${currentProduct.image || ""}`;

        function renderDetails(p) {
          if (!p) return;
          currentProduct = p;
          if (productBrand) productBrand.textContent = p.brand || "N/A";
          if (productTitle) productTitle.textContent = p.name || "";
          if (productPrice)
            productPrice.textContent = p.price_sale != null ? p.price_sale : "";
          if (productSale)
            productSale.textContent = p.price != null ? p.price : "";
          if (productDesc) productDesc.textContent = stripTags(p.description);
          if (productDesc1) productDesc1.textContent = stripTags(p.description);
          if (productLabel) productLabel.textContent = p.label || "";
          const stockCount = parseInt(p.minimumorder) || 0;
          if (productStock)
            productStock.textContent = `Only ${stockCount} items left in stock!`;

          const maxStock = 100;
          const percent = Math.min(
            Math.round((stockCount / maxStock) * 100),
            100
          );
          const lineBeforeStyleId = "dynamic-stock-line-style";
          const existingStyle = document.getElementById(lineBeforeStyleId);
          if (existingStyle) existingStyle.remove();
          const style = document.createElement("style");
          style.id = lineBeforeStyleId;
          style.innerHTML = `
              .item-left-line .line::before {
                background-color: #e53e3e !important;
                content: "";
                width: ${percent}% !important;
                height: 100% !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
              }
            `;
          document.head.appendChild(style);

          galleryMain.innerHTML = `
            <div class="swiper-slide">
              <div class="gallary-item">
                <img src="/api/uploads/${p.image}" alt="${p.name}"
                     style="width:100%;height:100%;object-fit:cover"/>
              </div>
            </div>`;

          gallerySide.innerHTML = `
            <div class="right-content"
                    <div class="gallary-item">
                      <img src="/api/uploads/${p.image}" alt="${p.name}" style="width: 100%; height: 100%; object-fit: cover;" />
                    </div>
                  </div>
                `;

          if (sizeBody) {
            sizeBody.innerHTML = "";
            const attrs = (p.attribute || "").split(",").map((s) => s.trim());
            const map = {};
            attrs.forEach((pair) => {
              const [k, v] = (pair || "").split(":").map((x) => x && x.trim());
              if (k && v) map[k.toLowerCase()] = v;
            });
            if (map.size || map.bust || map.waist || map.hip) {
              sizeBody.innerHTML = `
                  <tr>
                    <td>${(map.size || "--").toUpperCase()}</td>
                    <td>${map.bust || "--"}</td>
                    <td>${map.waist || "--"}</td>
                    <td>${map.hip || "--"}</td>
                  </tr>`;
            }
          }

          if (cartBtn) cartBtn.setAttribute("data-id", p.id);
          window.selectedProductName = p.name;
          window.selectedProductImg = `${p.image || ""}`;
        }

        function renderThumbs(arr) {
          if (!thumbWrapper) return;
          thumbWrapper.innerHTML = "";
          arr.forEach((p) => {
            if (!p) return;
            const d = document.createElement("div");
            d.className = "swiper-slide";
            d.innerHTML = `
                <div class="thumb-item">
                  <img src="/api/uploads/${p.image || ""}" alt="${(
              p.name || ""
            ).replace(/"/g, "")}"/>
                </div>`;
            d.addEventListener("click", () => {
              const previous = currentProduct && currentProduct.id;
              // switch main product
              renderDetails(p);
              // recompute related (prefer including previous main so thumbs stay stable)
              const newRelated = getRelatedFor(p.id, previous, 3);
              renderThumbs(newRelated);
              // update URL slug (non-reloading)
              try {
                const newSlug = p.slug || toSeoUrl(p.name);
                const base = window.location.pathname.replace(/\/[^/]*$/, "");
                window.history.replaceState(
                  {},
                  "",
                  base + "/" + encodeURIComponent(newSlug)
                );
              } catch {}
            });
            thumbWrapper.appendChild(d);
          });
        }

        if (cartBtn) {
          cartBtn.addEventListener("click", async (e) => {
            e.preventDefault();
            const user_id_now = localStorage.getItem("user_id");
            if (!user_id_now) {
              showErrorBanner("Please log in first");
              return;
            }
            const qty = parseInt(qtyInput && qtyInput.value, 10) || 1;
            const payload = {
              user_id: user_id_now,
              name: currentProduct && currentProduct.name,
              store: "default",
              price: currentProduct && currentProduct.price,
              price_sale: currentProduct && currentProduct.price_sale,
              image: currentProduct && currentProduct.image,
              quantity: qty,
            };
            try {
              const res = await fetch("/api/addcart", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });
              if (!res.ok) throw new Error("Add to cart failed");
              showSuccessBanner("Product added to cart!");
              cartBtn.innerHTML = `<i class="fa-solid fa-check"></i> Added!`;
              cartBtn.classList.add("added");
            } catch (err) {
              console.error(err);
              showErrorBanner("Failed to add to cart.");
            }
          });
        }

        // Rating UI (guarded)
        const starList = document.getElementById("star-rating");
        const ratingInput = document.getElementById("rating-value");
        let currentRating = 4;
        if (starList) {
          try {
            starList.style.flexDirection = "row";
            const stars = Array.from(starList.querySelectorAll("li"));
            function paint(u) {
              stars.forEach((li) => {
                const i = +li.dataset.index;
                const icon = li.querySelector("i");
                if (icon) icon.style.color = i <= u ? "#E53E3E" : "#ccc";
              });
            }
            function renderStars() {
              paint(currentRating);
            }
            stars.forEach((li) => {
              const idx = +li.dataset.index;
              li.addEventListener("mouseover", () => paint(idx));
              li.addEventListener("mouseout", renderStars);
              li.addEventListener("click", () => {
                currentRating = idx;
                if (ratingInput) ratingInput.value = idx;
                renderStars();
              });
            });
            renderStars();
          } catch (err) {
            console.warn("Star rating setup failed:", err);
          }
        }

        const form = document.querySelector(".review-form-wrap form");
        if (form) {
          form.addEventListener("submit", async (e) => {
            e.preventDefault();
            if (!currentRating || currentRating === 0) {
              showErrorBanner("Please select a star rating.");
              return;
            }
            const fd = new FormData(form);
            fd.append("product_name", window.selectedProductName || "");
            fd.append("product_image", window.selectedProductImg || "");
            try {
              const res = await fetch("/api/reviewdatasubmit", {
                method: "POST",
                body: fd,
              });
              if (!res.ok) {
                const t = await res.text();
                throw new Error(t || res.statusText);
              }
              showSuccessBanner("Review submitted successfully!");
              form.reset();
              currentRating = 0;
              if (ratingInput) ratingInput.value = 0;
              if (starList) {
                const stars = Array.from(starList.querySelectorAll("li"));
                stars.forEach((li) => {
                  const icon = li.querySelector("i");
                  if (icon) icon.style.color = "#ccc";
                });
              }
            } catch (err) {
              console.error(err);
              showErrorBanner("Failed to submit review.");
            }
          });
        }

        function showSuccessBanner(msg) {
          const b = document.createElement("div");
          b.className = "alert alert-success";
          Object.assign(b.style, {
            position: "fixed",
            top: "20px",
            right: "20px",
            zIndex: 9999,
          });
          b.innerText = msg;
          document.body.appendChild(b);
          setTimeout(() => b.remove(), 3000);
        }

        function showErrorBanner(msg) {
          const b = document.createElement("div");
          b.className = "alert alert-danger";
          Object.assign(b.style, {
            position: "fixed",
            top: "20px",
            right: "20px",
            zIndex: 9999,
          });
          b.innerText = msg;
          document.body.appendChild(b);
          setTimeout(() => b.remove(), 3000);
        }
      });
    </script>

    <!-- <script>
      document.addEventListener("DOMContentLoaded", async () => {
        let currentProduct = null;
        const productBrand = document.getElementById("product-brand");
        const productTitle = document.getElementById("product-title");
        const productPrice = document.getElementById("product-price");
        const productSale = document.getElementById("product-sale-price");
        const productDesc = document.getElementById("product-desc");
        const productDesc1 = document.getElementById("product-desc1");
        const productLabel = document.getElementById("product-label");
        const galleryMain = document.getElementById("product-gallery");
        const gallerySide = document.getElementById("product-gallery1");
        const thumbWrapper = document.getElementById("product-thumbs");
        const productStock = document.getElementById("product-stock");
        const sizeBody = document.getElementById("product-size-table-body");
        const cartBtn = document.querySelector(".cart-btn-wrap-2 .cart-btn");
        const qtyInput = document.getElementById("age");
        let products;

        function stripTags(html) {
          const tmp = document.createElement("div");
          tmp.innerHTML = html || "";
          return tmp.textContent || tmp.innerText;
        }

        try {
          const res = await fetch("/api/productpagedata");
          if (!res.ok) throw new Error("Failed to fetch products");
          products = await res.json();
        } catch (err) {
          console.error(err);
          showErrorBanner("Could not load products.");
          return;
        }

        if (!Array.isArray(products) || products.length === 0) {
          showErrorBanner("No products available.");
          return;
        }

        const requested = localStorage.getItem("selectedProductId");
        currentProduct = requested
          ? products.find((p) => String(p.id) === requested) || products[0]
          : products[0];
        localStorage.removeItem("selectedProductId");

        renderDetails(currentProduct);
        renderThumbs(products.slice(0, 3));

        window.selectedProductName = currentProduct.name;
        window.selectedProductImg = `${currentProduct.image}`;

        function renderDetails(p) {
          currentProduct = p;
          productBrand.textContent = p.brand || "N/A";
          productTitle.textContent = p.name || "";
          productPrice.textContent = p.price_sale || "";
          productSale.textContent = p.price || "";
          productDesc.textContent = stripTags(p.description);
          productDesc1.textContent = stripTags(p.description);
          productLabel.textContent = p.label || "";
          const stockCount = parseInt(p.minimumorder) || 0;
          productStock.textContent = `Only ${stockCount} items left in stock!`;

          const maxStock = 100;
          const percent = Math.min(
            Math.round((stockCount / maxStock) * 100),
            100
          );
          const lineBeforeStyleId = "dynamic-stock-line-style";
          const existingStyle = document.getElementById(lineBeforeStyleId);
          if (existingStyle) existingStyle.remove();

          const style = document.createElement("style");
          style.id = lineBeforeStyleId;
          style.innerHTML = `
          .item-left-line .line::before {
            background-color: #e53e3e !important;
            content: "";
            width: ${percent}% !important;
            height: 100% !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
          }
        `;
          document.head.appendChild(style);

          galleryMain.innerHTML = `
            <div class="swiper-slide">
              <div class="gallary-item">
                <img src="/api/uploads/${p.image}" alt="${p.name}"
                     style="width:100%;height:100%;object-fit:cover"/>
              </div>
            </div>`;

          gallerySide.innerHTML = `
            <div class="right-content"
             <div class="gallary-item">
             <img src="/api/uploads/${p.image}" alt="${p.name}" style="width: 100%; height: 100%; object-fit: cover;" />
            </div>
          </div>
        `;

          sizeBody.innerHTML = "";
          const attrs = (p.attribute || "").split(",").map((s) => s.trim());
          const map = {};
          attrs.forEach((pair) => {
            const [k, v] = pair.split(":").map((x) => x.trim());
            if (k && v) map[k.toLowerCase()] = v;
          });
          if (map.size || map.bust || map.waist || map.hip) {
            sizeBody.innerHTML = `
        <tr>
          <td>${(map.size || "--").toUpperCase()}</td>
          <td>${map.bust || "--"}</td>
          <td>${map.waist || "--"}</td>
          <td>${map.hip || "--"}</td>
        </tr>`;
          }

          if (cartBtn) cartBtn.setAttribute("data-id", p.id);
          window.selectedProductName = p.name;
          window.selectedProductImg = `${p.image}`;
        }

        function renderThumbs(arr) {
          thumbWrapper.innerHTML = "";
          arr.forEach((p) => {
            const d = document.createElement("div");
            d.className = "swiper-slide";
            d.innerHTML = `
        <div class="thumb-item">
          <img src="/api/uploads/${p.image}" alt="${p.name}"/>
        </div>`;
            d.addEventListener("click", () => renderDetails(p));
            thumbWrapper.appendChild(d);
          });
        }

        if (cartBtn) {
          cartBtn.addEventListener("click", async (e) => {
            e.preventDefault();

            const user_id_now = localStorage.getItem("user_id");
            if (!user_id_now) {
              showErrorBanner("Please log in first");
              return;
            }

            const qty = parseInt(qtyInput && qtyInput.value, 10) || 1;
            const payload = {
              user_id: user_id_now,
              name: currentProduct.name,
              store: "default",
              price: currentProduct.price,
              price_sale: currentProduct.price_sale,
              image: currentProduct.image,
              quantity: qty,
            };
            try {
              const res = await fetch("/api/addcart", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
              });
              if (!res.ok) throw new Error("Add to cart failed");
              showSuccessBanner("Product added to cart!");
              cartBtn.innerHTML = `<i class="fa-solid fa-check"></i> Added!`;
              cartBtn.classList.add("added");
            } catch (err) {
              console.error(err);
              showErrorBanner("Failed to add to cart.");
            }
          });
        }

        const starList = document.getElementById("star-rating");
        starList.style.flexDirection = "row";
        const stars = Array.from(starList.querySelectorAll("li"));
        const ratingInput = document.getElementById("rating-value");
        let currentRating = 4;
        function paint(u) {
          stars.forEach((li) => {
            const i = +li.dataset.index;
            li.querySelector("i").style.color = i <= u ? "#E53E3E" : "#ccc";
          });
        }
        function renderStars() {
          paint(currentRating);
        }
        stars.forEach((li) => {
          const idx = +li.dataset.index;
          li.addEventListener("mouseover", () => paint(idx));
          li.addEventListener("mouseout", renderStars);
          li.addEventListener("click", () => {
            currentRating = idx;
            ratingInput.value = idx;
            renderStars();
          });
        });
        renderStars();

        const form = document.querySelector(".review-form-wrap form");
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          if (currentRating === 0) {
            showErrorBanner("Please select a star rating.");
            return;
          }
          const fd = new FormData(form);
          fd.append("product_name", window.selectedProductName);
          fd.append("product_image", window.selectedProductImg);

          try {
            const res = await fetch("/api/reviewdatasubmit", {
              method: "POST",
              body: fd,
            });
            if (!res.ok) {
              const t = await res.text();
              throw new Error(t || res.statusText);
            }
            showSuccessBanner("Review submitted successfully!");
            form.reset();
            currentRating = 0;
            ratingInput.value = 0;
            renderStars();
          } catch (err) {
            console.error(err);
            showErrorBanner("Failed to submit review.");
          }
        });

        function showSuccessBanner(msg) {
          const b = document.createElement("div");
          b.className = "alert alert-success";
          Object.assign(b.style, {
            position: "fixed",
            top: "20px",
            right: "20px",
            zIndex: 9999,
          });
          b.innerText = msg;
          document.body.appendChild(b);
          setTimeout(() => b.remove(), 3000);
        }
        function showErrorBanner(msg) {
          const b = document.createElement("div");
          b.className = "alert alert-danger";
          Object.assign(b.style, {
            position: "fixed",
            top: "20px",
            right: "20px",
            zIndex: 9999,
          });
          b.innerText = msg;
          document.body.appendChild(b);
          setTimeout(() => b.remove(), 3000);
        }
      });
    </script> -->

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById("review-list");
        const reviewTabButton = document.querySelector(".contact-tab");
        const reviewTab = document.querySelector(".contact-tabs");

        function loadReviews() {
          fetch("/api/reviewdata")
            .then((res) => res.json())
            .then((reviews) => {
              container.innerHTML = "";

              const productName = window.selectedProductName || "";
              const matched = reviews.filter(
                (r) => r.product_name === productName
              );

              if (matched.length === 0) {
                container.innerHTML = `
                <div class="col-12 text-start text-danger fw-bold">
                  No reviews available of this product.
                </div>`;
                reviewTabButton.textContent = `Reviews(0)`;
                reviewTab.textContent = `(0 customer reviews)`;
                return;
              }

              matched.forEach((r) => {
                const date = new Date(r.date);
                const formattedDate = date.toLocaleDateString("en-GB", {
                  day: "2-digit",
                  month: "long",
                  year: "numeric",
                });

                let starsHtml = '<ul class="review">';
                for (let i = 1; i <= 5; i++) {
                  starsHtml += `<li class="${i <= r.star ? "filled" : ""}">
                          <i class="fa-sharp fa-solid fa-star"></i>
                        </li>`;
                }
                starsHtml += "</ul>";

                const words = r.comment.trim().split(/\s+/);
                const preview =
                  words.length > 20
                    ? words.slice(0, 20).join(" ") + "…"
                    : r.comment;

                const thumb = r.image
                  ? `<img src="https://media2.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fwww.gravatar.com%2Favatar%2F2c7d99fe281ecd3bcd65ab915bac6dd5%3Fs%3D250" alt="user photo">`
                  : `<i class="fa-regular fa-user fa-2x text-muted"></i>`;

                container.insertAdjacentHTML(
                  "beforeend",
                  `
                  <div class="review-item">
                    <div class="review-thumb">${thumb}</div>
                    <div class="content">
                      <div class="content-top">
                        <h4 class="name">
                          ${r.user_name} <span>${formattedDate}</span>
                        </h4>
                        ${starsHtml}
                      </div>
                      <p>${preview}</p>
                    </div>
                  </div>
                `
                );
              });

              reviewTabButton.textContent = `Reviews(${matched.length})`;
              reviewTab.textContent = `(${matched.length} customer review)`;
            })
            .catch((err) => {
              console.error("Failed to load reviews:", err);
            });
        }
        loadReviews();
        setInterval(loadReviews, 0);
        window.loadReviews = loadReviews;
      });
    </script>

    <footer class="footer-section bg-grey pt-60">
      <div class="container">
        <div class="footer-items">
          <div class="footer-item">
            <div class="icon">
              <img
                src="assets/img/icon/footer-1.png"
                alt="icon"
                loading="lazy"
              />
            </div>
            <div class="content">
              <h4 class="title">Free Shipping</h4>
              <span>Free shipping on orders over $65.00</span>
            </div>
          </div>
          <div class="footer-item">
            <div class="icon">
              <img
                src="assets/img/icon/footer-2.png"
                alt="icon"
                loading="lazy"
              />
            </div>
            <div class="content">
              <h4 class="title">Free Returns</h4>
              <span>30-days free return policy</span>
            </div>
          </div>
          <div class="footer-item">
            <div class="icon">
              <img
                src="assets/img/icon/footer-3.png"
                alt="icon"
                loading="lazy"
              />
            </div>
            <div class="content">
              <h4 class="title">Secured Payments</h4>
              <span>We accept all major credit card</span>
            </div>
          </div>
          <div class="footer-item item-2">
            <div class="icon">
              <img
                src="assets/img/icon/footer-4.png"
                alt="icon"
                loading="lazy"
              />
            </div>
            <div class="content">
              <h4 class="title">Customer Service</h4>
              <span>Top notch customer service</span>
            </div>
          </div>
        </div>
        <div class="row footer-widget-wrap pb-60">
          <div class="col-lg-3 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">About Store</h3>
              </div>
              <div class="footer-contact">
                <div class="icon">
                  <i class="fa-sharp fa-solid fa-phone-rotary"></i>
                </div>
                <div class="content">
                  <span>Have Question? Call Us 24/7</span>
                  <a href="tel:+25836922569">+258 3692 2569</a>
                </div>
              </div>
              <ul class="schedule-list">
                <li><span>Monday - Friday:</span>8:00am - 6:00pm</li>
                <li><span>Saturday:</span>8:00am - 6:00pm</li>
                <li><span>Sunday</span> Service Close</li>
              </ul>
            </div>
          </div>
          <div class="col-lg-2 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">Our Stores</h3>
              </div>
              <ul class="footer-list">
                <li><a href="contact.html">New York</a></li>
                <li><a href="contact.html">London SF</a></li>
                <li><a href="contact.html">Los Angele</a></li>
                <li><a href="contact.html">Chicago</a></li>
                <li><a href="contact.html">Las Vegas</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-2 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">Shop Categories</h3>
              </div>
              <ul class="footer-list">
                <li><a href="contact.html">New Arrivals</a></li>
                <li><a href="contact.html">Best Selling</a></li>
                <li><a href="contact.html">Vegetables</a></li>
                <li><a href="contact.html">Fresh Meat</a></li>
                <li><a href="contact.html">Fresh Seafood</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-2 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">Useful Links</h3>
              </div>
              <ul class="footer-list">
                <li><a href="contact.html">Privacy Policy</a></li>
                <li><a href="contact.html">Terms & Conditions</a></li>
                <li><a href="contact.html">Contact Us</a></li>
                <li><a href="contact.html">Latest News</a></li>
                <li><a href="contact.html">Our Sitemaps</a></li>
              </ul>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">Our Newsletter</h3>
              </div>
              <div class="news-form-wrap">
                <p class="mb-20">
                  Subscribe to the mailing list to receive updates one the new
                  arrivals and other discounts
                </p>
                <div class="footer-form mb-20">
                  <form action="#" class="rr-subscribe-form">
                    <input
                      class="form-control py-4"
                      type="email"
                      name="email"
                      placeholder="Email address"
                      required
                    />
                    <input
                      type="hidden"
                      name="action"
                      value="mailchimpsubscribe"
                    />
                    <button class="submit" type="submit">Subscribe</button>
                    <div class="clearfix"></div>
                  </form>
                </div>
                <p class="mb-0">
                  I would like to receive news and special offer
                </p>
              </div>
            </div>
          </div>

          <script>
            document.addEventListener("DOMContentLoaded", () => {
              const form = document.querySelector(".rr-subscribe-form");
              if (!form) return;

              function showBanner(msg, type = "success") {
                const b = document.createElement("div");
                b.className = `banner ${type}`;
                b.textContent = msg;
                Object.assign(b.style, {
                  position: "fixed",
                  top: "10px",
                  left: "50%",
                  transform: "translateX(-50%)",
                  padding: "10px 20px",
                  background: type === "success" ? "#4caf50" : "#f44336",
                  color: "#fff",
                  borderRadius: "4px",
                  zIndex: 9999,
                  boxShadow: "0 2px 6px rgba(0,0,0,0.3)",
                });
                document.body.appendChild(b);
                setTimeout(() => b.remove(), 3000);
              }

              form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const input = form.querySelector('input[name="email"]');
                const email = input.value.trim();
                if (!email) {
                  showBanner("Please enter a valid email.", "error");
                  return;
                }

                try {
                  const res = await fetch("/api/newsletterpost", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email }),
                  });
                  const text = await res.text();

                  if (res.ok) {
                    showBanner("Subscribed successfully!", "success");
                    form.reset();
                  } else {
                    showBanner(text || "Subscription failed.", "error");
                  }
                } catch (err) {
                  console.error("Newsletter error:", err);
                  showBanner("Network error, please try again.", "error");
                }
              });
            });
          </script>
        </div>
      </div>

      <div class="copyright-area">
        <div class="container">
          <div class="row copyright-content">
            <div class="col-lg-6">
              <div class="footer-img-wrap">
                <span>Payment System:</span>
                <div class="footer-img">
                  <a
                    href="/"
                    aria-label="Go to homepage"
                    title="Go to homepage"
                  >
                    <img
                      src="https://avatars.mds.yandex.net/i?id=bec5b0beccb70346fc778cdb735d787bcd15343d-12937823-images-thumbs&n=13"
                      alt="img"
                      style="width: 264px; height: 24px"
                      loading="lazy"
                  /></a>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <p>
                Copyright & Design <span id="designYear">2025</span>
                <span>©Roiser</span>. All Right Reserved
              </p>
            </div>

            <script>
              document.addEventListener("DOMContentLoaded", () => {
                const yearSpan = document.getElementById("designYear");
                if (yearSpan) {
                  yearSpan.textContent = new Date().getFullYear();
                }
              });
            </script>
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        fetch("/api/get-font-settings")
          .then((res) => {
            if (!res.ok) throw new Error("Network error");
            return res.json();
          })
          .then((cfg) => {
            const s = document.createElement("style");
            s.type = "text/css";

            s.textContent = `
            body {
                font-family: ${cfg.font_family}, sans-serif !important;
                font-size: ${cfg.body_font_size}px !important;
              }
              h1 { font-size: ${cfg.h1_font_size}px !important; }
              h2 { font-size: ${cfg.h2_font_size}px !important; }
              h3 { font-size: ${cfg.h3_font_size}px !important; }
              h4 { font-size: ${cfg.h4_font_size}px !important; }
              h5 { font-size: ${cfg.h5_font_size}px !important; }
              h6 { font-size: ${cfg.h6_font_size}px !important; }
            `;
            document.head.appendChild(s);
          })
          .catch((err) => {
            console.error("Could not load font settings:", err);
          });
      });
    </script>

    <div id="scroll-percentage"><span id="scroll-percentage-value"></span></div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        fetch("/api/get-theme-logo")
          .then((res) => {
            if (!res.ok) throw new Error("Failed to load logo data");
            return res.json();
          })
          .then((cfg) => {
            const img = document.getElementById("site-logo");
            if (!img) return;
            if (cfg.logo_url) {
              img.src = `/api/${cfg.logo_url}`;
            }
            if (cfg.logo_height) {
              img.height = cfg.logo_height;
            }
          })
          .catch((err) => {
            console.error("Could not load theme logo:", err);
          });

        fetch("/api/themestylesdata")
          .then((res) => {
            if (!res.ok) throw new Error("Network error");
            return res.json();
          })
          .then((cfg) => {
            const topBg = cfg.headerBackgroundColor || "#ffffff";
            const topBar = document.querySelector(".top-bar");
            if (topBar) {
              topBar.style.setProperty("background-color", topBg, "important");
              topBar.querySelectorAll(
                "a, span, li, .nice-select .current, .nice-select .option"
              );
            }

            const midBg = cfg.headerMainColor || "#ffffff";
            const midTxt = cfg.headerMainTextColor || "#000000";
            const headerMid = document.querySelector(".header-middle");
            if (headerMid) {
              headerMid.style.setProperty(
                "background-color",
                midBg,
                "important"
              );
              headerMid
                .querySelectorAll(
                  "a, span, li, .contact-item-list .content span, " +
                    ".contact-item-list .content a, .contact-item-list .number, " +
                    ".rr-primary-btn, .nice-select .current, .nice-select .option"
                )
                .forEach((el) => {
                  el.style.setProperty("color", midTxt, "important");
                });
            }

            const scrollPercentage =
              document.getElementById("scroll-percentage");
            if (scrollPercentage) {
              if (cfg.backToTopButton === "no") {
                scrollPercentage.style.display = "none";
              } else {
                scrollPercentage.style.display = "block";
              }
            }
          })
          .catch((err) => {
            console.error("Could not load theme styles:", err);
          });
      });
    </script>

    <script src="assets/js/vendor/jquary-3.6.0.min.js"></script>
    <script src="assets/js/vendor/bootstrap-bundle.js"></script>
    <script src="assets/js/vendor/imagesloaded-pkgd.js"></script>
    <script src="assets/js/vendor/waypoints.min.js"></script>
    <script src="assets/js/vendor/venobox.min.js"></script>
    <script src="assets/js/vendor/odometer.min.js"></script>
    <script src="assets/js/vendor/meanmenu.js"></script>
    <script src="assets/js/vendor/smooth-scroll.js"></script>
    <script src="assets/js/vendor/jquery.isotope.js"></script>
    <script src="assets/js/vendor/wow.min.js"></script>
    <script src="assets/js/vendor/swiper.min.js"></script>
    <script src="assets/js/vendor/split-type.min.js"></script>
    <script src="assets/js/vendor/gsap.min.js"></script>
    <script src="assets/js/vendor/scroll-trigger.min.js"></script>
    <script src="assets/js/vendor/nice-select.js"></script>
    <script src="assets/js/ajax-form.js"></script>
    <script src="assets/js/contact.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
  </body>
</html>
