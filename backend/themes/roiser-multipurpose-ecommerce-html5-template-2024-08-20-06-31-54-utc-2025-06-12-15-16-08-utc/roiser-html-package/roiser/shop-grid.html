<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Explore our latest collection and shop online for the best deals on top-quality products. Fast shipping & secure checkout available."
    />
    <title>Shop Online - Best Deals & Latest Collections | Roiser</title>
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="assets/img/favicon.png"
    />
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/fontawesome.min.css" />
    <link rel="stylesheet" href="assets/css/nice-select.css" />
    <link rel="stylesheet" href="assets/css/main.css" />

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        function makeAbsolute(u) {
          if (!u) return u;
          if (/^https?:\/\//i.test(u)) return u;
          return window.location.origin + (u.startsWith("/") ? u : "/" + u);
        }

        fetch("/api/productpagedata")
          .then((r) => r.json())
          .then((products) => {
            products = Array.isArray(products)
              ? products
              : products.items || [];

            const productSchema = products.map((p) => ({
              "@type": "Product",
              name: p.name || "",
              image: makeAbsolute("/api/" + (p.image || "")),
              description: p.description
                ? p.description.replace(/<[^>]+>/g, "")
                : "",
              sku: p.sku || p.id || "",
              brand: { "@type": "Brand", name: p.brand || "" },
              offers: {
                "@type": "Offer",
                url: makeAbsolute(
                  p.permalink
                    ? "/shop-details/" + p.permalink
                    : `/shop-details/${p.id || ""}`
                ),
                priceCurrency: "USD",
                price: p.price_sale
                  ? p.price_sale.replace(/[^0-9.]/g, "")
                  : p.price
                  ? p.price.replace(/[^0-9.]/g, "")
                  : undefined,
                availability:
                  p.stockstatus && /in stock/i.test(p.stockstatus)
                    ? "https://schema.org/InStock"
                    : "https://schema.org/OutOfStock",
              },
            }));

            const schemaData = {
              "@context": "https://schema.org",
              "@graph": [
                {
                  "@type": "CollectionPage",
                  name: "Shop Grid - ROISER",
                  description:
                    "Browse our latest collection of premium electronics, wellness, and healthcare products.",
                  url: window.location.href,
                },
                ...productSchema,
              ].filter(Boolean),
            };

            const script = document.createElement("script");
            script.type = "application/ld+json";
            script.text = JSON.stringify(schemaData);
            document.head.appendChild(script);
          })
          .catch((err) => console.error("Schema error", err));
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document
          .querySelectorAll("a[href$='.html']:not(.lang-btn)")
          .forEach((a) => {
            const href = a.getAttribute("href");
            const page = href.replace(/\.html$/, "");
            if (page === "index" || page === "") {
              a.setAttribute("href", "http://localhost:5173/");
            } else {
              a.setAttribute("href", `http://localhost:5173/${page}`);
            }
            a.addEventListener("click", (e) => {
              e.preventDefault();
              if (page === "index" || page === "") {
                window.parent.location.href = "http://localhost:5173/";
              } else {
                window.parent.location.href = `http://localhost:5173/${page}`;
              }
            });
          });
        document.querySelectorAll('a[href="#"]').forEach((a) => {
          a.addEventListener("click", (e) => e.preventDefault());
        });
      });
    </script>
  </head>

  <style>
    .grid-shop .shop-thumb {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 180px;
      overflow: hidden;
      position: relative;
    }

    .grid-shop .shop-thumb img.list-roiser-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      flex-shrink: 0;
    }

    .shop-items-str {
      height: 500px !important;
    }
  </style>

  <body>
    <header class="header sticky-active">
      <div class="top-bar">
        <div class="container">
          <div class="top-bar-inner">
            <div class="top-bar-left">
              <ul class="top-left-list">
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">My Account</a></li>
                <li><a href="wishlist.html">Wishlist</a></li>
                <li><a href="checkout.html">Checkout</a></li>
              </ul>
            </div>

            <div class="top-bar-middle">
              <span
                id="announcement-text"
                style="
                  display: inline-block;
                  transition: transform 0.5s ease;
                  white-space: nowrap;
                "
              ></span>
            </div>

            <div class="top-bar-right">
              <ul class="top-right-list">
                <li><a href="contact.html">Store Location</a></li>
                <li>
                  <div class="nice-select select-control country1" tabindex="0">
                    <span class="current">Language</span>
                    <ul class="list">
                      <li data-value="" class="option selected focus">
                        Language
                      </li>
                      <li data-value="vdt" class="option">English</li>
                      <li data-value="can" class="option">Bangla</li>
                      <li data-value="uk" class="option">Arabic</li>
                    </ul>
                  </div>
                </li>
                <li>
                  <div
                    class="nice-select select-control select-2 country"
                    tabindex="0"
                  >
                    <span class="current">Currency</span>
                    <ul class="list">
                      <li data-value="" class="option selected focus">
                        Currency
                      </li>
                      <li data-value="vdt" class="option">Doller</li>
                      <li data-value="can" class="option">Rupee</li>
                      <li data-value="uk" class="option">Taka</li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="header-middle">
        <div class="container">
          <div class="header-middle-inner">
            <div class="header-middle-left">
              <div class="header-logo d-lg-block">
                <a href="index.html">
                  <img
                    src="assets/img/logo/logo-1.png"
                    alt="Logo"
                    loading="lazy"
                    id="site-logo"
                  />
                </a>
              </div>

              <div class="category-form-wrap">
                <div class="nice-select select-control country" tabindex="0">
                  <span class="current">ALL Categories</span>
                  <ul class="list">
                    <li data-value="" class="option selected focus">
                      ALL Categories
                    </li>
                    <li data-value="vdt" class="option">Fashion</li>
                    <li data-value="can" class="option">Organic</li>
                    <li data-value="uk" class="option">Furniture</li>
                  </ul>
                </div>

                <form class="header-form">
                  <input
                    class="form-control"
                    type="text"
                    name="search"
                    placeholder="Search here..."
                    required
                  />
                  <button class="submit rr-primary-btn" type="submit">
                    Search here
                  </button>
                </form>
              </div>
            </div>

            <div class="header-middle-right">
              <ul class="contact-item-list">
                <li>
                  <div class="content">
                    <span>Call Us Now:</span>
                    <a class="number" href="tel:+25821592159"
                      >+(258) 2159-2159</a
                    >
                  </div>
                  <a href="tel:+25821592159" class="icon" aria-label="Call us">
                    <i class="fa-regular fa-phone"></i>
                  </a>
                </li>
                <li>
                  <a
                    href="wishlist.html"
                    class="icon"
                    aria-label="View wishlist"
                  >
                    <i class="fa-sharp fa-regular fa-heart"></i>
                  </a>
                </li>
                <li>
                  <a href="cart.html" class="icon" aria-label="View cart">
                    <i class="fa-light fa-bag-shopping"></i>
                    <span>0</span>
                  </a>
                  <div class="content">
                    <span>Your cart,</span>
                    <h5 class="number">$0.00</h5>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="primary-header">
        <div class="container">
          <div class="primary-header-inner">
            <div class="header-logo mobile-logo">
              <a href="index.html">
                <img
                  src="assets/img/logo/logo-1.png"
                  alt="Logo"
                  loading="lazy"
                />
              </a>
            </div>
            <div class="header-menu-wrap">
              <div class="mobile-menu-items">
                <ul>
                  <li class="menu-item-has-children active">
                    <a href="index.html">Home</a>
                    <ul>
                      <li><a href="index.html">Fashion Home</a></li>
                      <li><a href="index-2.html">Grocery Home</a></li>
                      <li><a href="index-3.html">Furniture</a></li>
                    </ul>
                  </li>
                  <li class="menu-item-has-children">
                    <a href="shop.html">Shop</a>
                    <ul>
                      <li><a href="shop.html">Shop</a></li>
                      <li><a href="shop-grid.html">Shop Grid</a></li>
                      <li><a href="shop-details.html">Shop Details</a></li>
                      <li><a href="cart.html">Cart</a></li>
                      <li><a href="wishlist.html">Wishlist</a></li>
                      <li><a href="checkout.html">Checkout</a></li>
                    </ul>
                  </li>
                  <li>
                    <a href="shop-grid.html">Women</a>
                  </li>
                  <li>
                    <a href="shop-grid.html">men</a>
                  </li>
                  <li class="menu-item-has-children">
                    <a href="/about">Pages</a>
                    <ul>
                      <li><a href="about.html">About</a></li>
                      <li><a href="login.html">Login</a></li>
                      <li><a href="register.html">Register</a></li>
                      <li><a href="faq.html">Faq</a></li>
                      <li><a href="error.html">404 Error</a></li>
                    </ul>
                  </li>
                  <li class="menu-item-has-children">
                    <a href="blog-grid.html">Blog</a>
                    <ul>
                      <li><a href="blog-grid.html">Blog Grid</a></li>
                      <li><a href="blog-list.html">Blog list</a></li>
                      <li><a href="blog-details.html">Blog Details</a></li>
                    </ul>
                  </li>
                  <li><a href="contact.html">Contact</a></li>
                </ul>
              </div>
            </div>
            <div class="header-right-wrap">
              <div class="header-right">
                <span>Get 30% Discount Now <span>Sale</span></span>
                <div class="header-right-item">
                  <button
                    class="mobile-side-menu-toggle"
                    aria-label="Toggle mobile menu"
                    type="button"
                  >
                    <i class="fa-sharp fa-solid fa-bars" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div id="popup-search-box">
      <div class="box-inner-wrap d-flex align-items-center">
        <form id="form" action="#" method="get" role="search">
          <input
            id="popup-search"
            type="text"
            name="search"
            placeholder="Type keywords here..."
          />
        </form>
        <div class="search-close">
          <i class="fa-sharp fa-regular fa-xmark"></i>
        </div>
      </div>
    </div>

    <div class="mobile-side-menu">
      <div class="side-menu-content">
        <div class="side-menu-head">
          <a href="index.html"
            ><img src="assets/img/logo/logo-1.png" alt="logo" loading="lazy"
          /></a>
          <button class="mobile-side-menu-close">
            <i class="fa-regular fa-xmark"></i>
          </button>
        </div>
        <div class="side-menu-wrap"></div>
        <ul class="side-menu-list">
          <li>
            <i class="fa-light fa-location-dot"></i>Address :
            <span>Amsterdam, 109-74</span>
          </li>
          <li>
            <i class="fa-light fa-phone"></i>Phone :
            <a href="tel:+01569896654">+01 569 896 654</a>
          </li>
          <li>
            <i class="fa-light fa-envelope"></i>Email :
            <a href="mailto:info@example.com">info@example.com</a>
          </li>
        </ul>
      </div>
    </div>

    <div id="preloader">
      <div class="preloader-close">X</div>
      <div class="sk-three-bounce">
        <div class="sk-child sk-bounce1"></div>
        <div class="sk-child sk-bounce2"></div>
        <div class="sk-child sk-bounce3"></div>
      </div>
    </div>

    <section class="page-header">
      <div class="shape">
        <img
          src="assets/img/shapes/page-header-shape.png"
          alt="shape"
          loading="lazy"
        />
      </div>
      <div class="container">
        <div class="page-header-content">
          <h1 class="title">Shop Grid</h1>
          <h2 class="sub-title">
            <span class="home">
              <a href="#">
                <span>Home</span>
              </a>
            </span>
            <span class="icon"><i class="fa-solid fa-angle-right"></i></span>
            <span class="inner">
              <span>Shop Grid</span>
            </span>
          </h2>
        </div>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          const res = await fetch("/api/get-theme-breadcrumb");
          const config = await res.json();

          const section = document.querySelector(".page-header");
          const content = section.querySelector(".page-header-content");
          const titleEl = content.querySelector(".title");
          const crumbEl = content.querySelector(".sub-title");
          const imgEl = section.querySelector(".shape img");

          if (config.enable_breadcrumb === "no") {
            titleEl.style.display = "none";
            crumbEl.style.display = "none";
          } else {
            titleEl.style.display = "";
            crumbEl.style.display = "";
          }

          if (config.breadcrumb_height) {
            section.style.height = config.breadcrumb_height + "px";
          }

          if (config.background_color) {
            section.style.backgroundColor = config.background_color;
          }

          if (config.background_image && config.background_image.trim()) {
            const bg = config.background_image.trim();
            imgEl.src = bg.startsWith("http") ? bg : `/api/${bg}`;
          }

          if (
            config.enable_breadcrumb === "yes" &&
            config.hide_title === "yes"
          ) {
            titleEl.style.display = "none";
          }

          if (config.enable_breadcrumb === "yes") {
            switch (config.breadcrumb_style) {
              case "none":
                crumbEl.style.display = "none";
                break;
              case "align center":
                content.style.textAlign = "center";
                break;
              default:
                content.style.textAlign = "start";
            }
          }
        } catch (e) {
          console.error("Breadcrumb config failed to load:", e);
        }
      });
    </script>

    <section class="shop-grid pt-100 pb-100">
      <div class="container">
        <div class="row">
          <div class="col-lg-9 col-md-12">
            <div class="shop-grid-left">
              <div
                class="top-grid-content d-flex justify-content-between align-items-center mb-4"
              >
                <div class="shop-tab-nav">
                  <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                      <button
                        class="nav-link active"
                        id="nav-home-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#nav-home"
                        type="button"
                        role="tab"
                        aria-selected="true"
                        aria-label="Grid view"
                        title="Grid view"
                      >
                        <svg
                          width="20"
                          height="17"
                          viewBox="0 0 20 17"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <rect
                            x="15"
                            width="5"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            x="15"
                            y="7"
                            width="5"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            x="15"
                            y="14"
                            width="5"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            x="7.71875"
                            width="5"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            x="7.71875"
                            y="7"
                            width="5"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            x="7.71875"
                            y="14"
                            width="5"
                            height="3"
                            fill="currentColor"
                          />
                          <rect width="5" height="3" fill="currentColor" />
                          <rect
                            y="7"
                            width="5"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            y="14"
                            width="5"
                            height="3"
                            fill="currentColor"
                          />
                        </svg>
                      </button>
                      <button
                        class="nav-link"
                        id="nav-profile-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#nav-profile"
                        type="button"
                        role="tab"
                        aria-selected="false"
                        aria-label="List view"
                        title="List view"
                      >
                        <svg
                          width="20"
                          height="17"
                          viewBox="0 0 20 17"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <rect
                            x="5.71875"
                            width="14.2857"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            x="5.71875"
                            y="7"
                            width="14.2857"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            x="5.71875"
                            y="14"
                            width="14.2857"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            width="3.80952"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            y="7"
                            width="3.80952"
                            height="3"
                            fill="currentColor"
                          />
                          <rect
                            y="14"
                            width="3.80952"
                            height="3"
                            fill="currentColor"
                          />
                        </svg>
                      </button>
                    </div>
                  </nav>
                  <span id="product-count">Showing 0 results</span>
                </div>

                <div class="nice-select shop-select country" tabindex="0">
                  <span class="current">Default Shorting</span>
                  <ul class="list">
                    <li data-value="" class="option selected focus">
                      Default Shorting
                    </li>
                    <li data-value="vdt" class="option">Most Popular</li>
                    <li data-value="can" class="option">Date</li>
                    <li data-value="uk" class="option">Trending</li>
                    <li data-value="dk" class="option">Featured</li>
                    <li data-value="dl" class="option">Discounted</li>
                  </ul>
                </div>
              </div>

              <div class="tab-content" id="nav-tabContent">
                <div
                  class="tab-pane fade show active"
                  id="nav-home"
                  role="tabpanel"
                  aria-labelledby="nav-home-tab"
                >
                  <div class="row gy-4"></div>
                </div>
                <div
                  class="tab-pane fade"
                  id="nav-profile"
                  role="tabpanel"
                  aria-labelledby="nav-profile-tab"
                >
                  <div class="grid-shop-items"></div>
                </div>
              </div>

              <ul class="pagination-wrap mt-50" id="product-pagination"></ul>
            </div>
          </div>

          <div class="col-lg-3 col-md-12">
            <div class="shop-sidebar">
              <h3 class="sidebar-header">Categories</h3>
              <ul class="sidebar-list" id="category-filter-list"></ul>
            </div>

            <div class="shop-sidebar">
              <h3 class="sidebar-header">Filter by price</h3>
              <div class="filter-box">
                <div class="range-slider">
                  <label for="price-range" class="sr-only"
                    >Filter products by price</label
                  >
                  <input
                    type="range"
                    min="20"
                    max="500"
                    value="300"
                    id="price-range"
                    aria-describedby="price-output"
                  />
                  <div class="slider-line" aria-hidden="true"></div>

                  <div class="range-slider-output" aria-hidden="false">
                    <h3 class="price">
                      Price: <span id="price-min">20</span> —
                      <span id="price-max">500</span>
                    </h3>
                    <h3 id="price-output" class="price" aria-live="polite">
                      $<span>300</span>
                    </h3>
                  </div>
                </div>
              </div>
            </div>

            <div class="shop-sidebar">
              <h3 class="sidebar-header">Item Size</h3>
              <div class="radion-btn-area">
                <div class="radio-item">
                  <label for="radio-1">
                    <input
                      type="radio"
                      id="radio-1"
                      name="flavor"
                      value="vanilla"
                    />
                    <span class="size">XL</span>
                  </label>
                  <span class="number">(15)</span>
                </div>
                <div class="radio-item">
                  <label for="radio-2">
                    <input
                      type="radio"
                      id="radio-2"
                      name="flavor"
                      value="vanilla"
                    />
                    <span class="size">S</span>
                  </label>
                  <span class="number">(15)</span>
                </div>
                <div class="radio-item">
                  <label for="radio-3">
                    <input
                      type="radio"
                      id="radio-3"
                      name="flavor"
                      value="vanilla"
                    />
                    <span class="size">M</span>
                  </label>
                  <span class="number">(15)</span>
                </div>
                <div class="radio-item">
                  <label for="radio-4">
                    <input
                      type="radio"
                      id="radio-4"
                      name="flavor"
                      value="vanilla"
                    />
                    <span class="size">L</span>
                  </label>
                  <span class="number">(15)</span>
                </div>

                <div class="radio-item">
                  <label for="radio-5">
                    <input
                      type="radio"
                      id="radio-5"
                      name="flavor"
                      value="vanilla"
                    />
                    <span class="size">XXL</span>
                  </label>
                  <span class="number">(15)</span>
                </div>
              </div>
            </div>

            <div class="shop-sidebar">
              <h3 class="sidebar-header">Brands</h3>
              <ul class="sidebar-list list-2" id="brand-filter-list"></ul>
            </div>

            <div class="shop-sidebar sticky-widget">
              <h3 class="sidebar-header">Brands</h3>
              <div class="sidebar-items" id="latest-products"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let currentSort = "";
        const apiEndpoint = "/api/productpagedata";
        const catEndpoint = "/api/productcatdata";
        const imageBaseUrl =
          "https://via.placeholder.com/300x300?text=No+Image";
        const PER_PAGE = 12;

        const imageLightbox = document.getElementById("image-lightbox");
        const lightboxImg = document.getElementById("lightbox-image");
        const counterEl = document.getElementById("lightbox-counter");
        const btnPrev = document.getElementById("lightbox-prev");
        const btnNext = document.getElementById("lightbox-next");
        const btnClose = document.getElementById("lightbox-close");
        const gridContainer = document.querySelector("#nav-home .row.gy-4");
        const listContainer = document.querySelector(
          "#nav-profile .grid-shop-items"
        );
        const productCount = document.getElementById("product-count");
        const paginationEl = document.getElementById("product-pagination");
        const priceInput = document.getElementById("price-range");
        const priceOutput = document.querySelector("#price-output span");

        let masterProducts = [];
        let allProducts = [];
        let productMainImages = [];
        let currentPage = 1;
        let pageGroupStart = 1;
        let currentImages = [];
        let currentIndex = 0;

        fetchAllProducts();
        loadLatestSidebar();
        setupPriceListener();

        // helper: generate URL-safe slug from product name
        function slugify(text) {
          return String(text || "")
            .toLowerCase()
            .trim()
            .replace(/&/g, "-and-")
            .replace(/[\s\W-]+/g, "-") // collapse spaces and non-word chars
            .replace(/^-+|-+$/g, "");
        }

        function fetchAllProducts() {
          fetch(apiEndpoint)
            .then((res) => res.json())
            .then((data) => {
              masterProducts = data;
              masterProducts.sort(
                (a, b) => new Date(b.date) - new Date(a.date)
              );
              productMainImages = masterProducts.map((p) => {
                const imgs = (p.image || "")
                  .split(",")
                  .map((i) => i.trim())
                  .filter(Boolean);
                return imgs[0] || "";
              });
              populateFilters();
              setupSortListener();
              loadProducts(masterProducts);
            })
            .catch((err) => {
              console.error("Error fetching products:", err);
              if (paginationEl) paginationEl.style.display = "none";
            });
        }

        function populateFilters() {
          fetch(catEndpoint)
            .then((res) => res.json())
            .then((categories) => {
              const catCounts = {};
              masterProducts.forEach((p) => {
                (p.categories || "")
                  .split(",")
                  .map((s) => s.trim())
                  .forEach((cat) => {
                    if (!cat) return;
                    catCounts[cat] = (catCounts[cat] || 0) + 1;
                  });
              });

              const categoryList = document.getElementById(
                "category-filter-list"
              );
              if (categoryList) {
                categoryList.innerHTML = categories
                  .map((cat, i) => {
                    const cnt = catCounts[cat.name] || 0;
                    return `
                <li>
                  <input type="checkbox" id="category-${i}" value="${cat.name}" />
                  <label for="category-${i}">${cat.name}</label>
                  <span class="number">(${cnt})</span>
                </li>`;
                  })
                  .join("");
              }

              setupFilterListeners();
            })
            .catch((err) => console.error("Error fetching categories:", err));

          const sizeCounts = {};
          masterProducts.forEach((p) => {
            (p.attribute || "")
              .split(",")
              .map((s) => s.trim())
              .forEach((attr) => {
                const [k, v] = (attr || "")
                  .split(":")
                  .map((x) => x && x.trim());
                if (k === "Size" && v) sizeCounts[v] = (sizeCounts[v] || 0) + 1;
              });
          });
          const sizeArea = document.querySelector(".radion-btn-area");
          if (sizeArea) {
            sizeArea.innerHTML = Object.entries(sizeCounts)
              .map(
                ([sz, cnt], i) => `
            <div class="radio-item">
              <label for="size-${i}">
                <input type="radio" id="size-${i}" name="size" />
                <span class="size">${sz}</span>
              </label>
              <span class="number">(${cnt})</span>
            </div>`
              )
              .join("");
          }

          const brandCounts = {};
          masterProducts.forEach((p) => {
            const br = (p.brand || "").trim();
            if (br) brandCounts[br] = (brandCounts[br] || 0) + 1;
          });
          const brandList = document.getElementById("brand-filter-list");
          if (brandList) {
            brandList.innerHTML = Object.entries(brandCounts)
              .map(
                ([br, cnt], i) => `
            <li>
              <div class="left-item">
                <input type="checkbox" id="brand-${i}" value="${br}" />
                <label for="brand-${i}">${br}</label>
              </div>
              <span class="number">(${cnt})</span>
            </li>`
              )
              .join("");
          }
        }

        function setupSortListener() {
          document
            .querySelectorAll(".shop-select.country .option")
            .forEach((li) =>
              li.addEventListener("click", () => {
                currentSort = li.getAttribute("data-value") || "";
                applyFilters();
              })
            );
        }

        function setupPriceListener() {
          if (priceInput && priceOutput) {
            priceInput.addEventListener("input", () => {
              priceOutput.textContent = priceInput.value;
              applyFilters();
            });
          }
        }

        function setupFilterListeners() {
          document
            .querySelectorAll(
              "#category-filter-list input, #brand-filter-list input, .radion-btn-area input"
            )
            .forEach((el) => el.addEventListener("change", applyFilters));
        }

        function loadProducts(products) {
          allProducts = products.slice();
          currentPage = 1;
          pageGroupStart = 1;
          renderProducts(1);
          if (allProducts.length > PER_PAGE) {
            renderPagination();
            if (paginationEl) paginationEl.style.display = "flex";
          } else {
            if (paginationEl) paginationEl.style.display = "none";
          }
        }

        function renderProducts(page) {
          const start = (page - 1) * PER_PAGE,
            end = start + PER_PAGE;
          const subset = allProducts.slice(start, end);
          if (gridContainer) gridContainer.innerHTML = "";
          if (listContainer) listContainer.innerHTML = "";
          if (productCount)
            productCount.textContent = `Showing ${start + 1} - ${Math.min(
              end,
              allProducts.length
            )} of ${allProducts.length} results`;

          subset.forEach((p, idx) => {
            const absIdx = start + idx;
            const stars =
              '<li><i class="fa-solid fa-star me-1"></i></li>'.repeat(
                p.rating || 5
              );
            // determine slug (use provided slug if exists, otherwise slugify name)
            const slug =
              p.slug && p.slug.trim() ? p.slug.trim() : slugify(p.name);
            const safeHref = `/shop-details/${encodeURIComponent(slug)}`;
            // first image only for listing
            const firstImg =
              (p.image || "")
                .split(",")
                .map((s) => s.trim())
                .filter(Boolean)[0] || "";
            const imgUrl = firstImg ? `/api/${firstImg}` : imageBaseUrl;

            if (gridContainer) {
              gridContainer.innerHTML += `<div class="col-xl-4 col-lg-6 col-md-6 d-flex align-items-stretch shop-items-str">
            <div class="shop-item w-100 d-flex flex-column border">
              <div class="shop-thumb w-100">
                <div class="overlay"></div>
                <a href="${safeHref}" class="product-link" data-slug="${slug}" data-id="${
                p.id
              }" aria-label="View details for ${p.name}">
                    <img src="${imgUrl}" class="img-fluid shop-thumb-grid" alt="${
                p.name
              }" />
                  </a>

                <span class="sale">${p.label || "New"}</span>
                <ul class="shop-list">
                  <li><a href="javascript:void(0)" class="add-to-cart" data-name="${
                    p.name
                  }" data-price="${p.price}" data-price_sale="${
                p.price_sale
              }" data-image="${
                p.image
              }"><i class="fa-regular fa-cart-shopping"></i></a></li>
                  <li><a href="javascript:void(0)" class="add-to-wishlist" data-name="${
                    p.name
                  }" data-image="${p.image}" data-store="default" data-price="${
                p.price
              }" data-price_sale="${p.price_sale}" data-sku="${
                p.sku || ""
              }" data-stockstatus="${
                p.stockstatus || "In Stock"
              }"><i class="fa-light fa-heart"></i></a></li>
                  <li><a href="javascript:void(0)" class="view-lightbox" data-index="${absIdx}"><i class="fa-light fa-eye"></i></a></li>
                </ul>
              </div>
              <div class="shop-content mt-auto">
                <span class="category fw-bold">${p.brand || ""}</span>
                <h3 class="title"><a href="${safeHref}" class="product-link" data-slug="${slug}" data-id="${
                p.id
              }">${p.name}</a></h3>
                <div class="review-wrap"><ul class="review">${stars}</ul>
                <span>(${Math.floor(Math.random() * 100) + 1} Reviews)</span>
                </div>
                <div class="d-flex flex-row flex-nowrap align-items-end">
                      <span class="price">${p.price}</span>
                      <span class="price_sale ms-2 text-decoration-line-through">${
                        p.price_sale
                      }</span>
                      </div>
                      </div>
                    </div>
                  </div>`;
            }

            if (listContainer) {
              listContainer.innerHTML += `<div class="shop-item grid-shop">
            <div class="shop-thumb">
              <div class="overlay"></div>
              <a href="${safeHref}" class="product-link" data-slug="${slug}" data-id="${
                p.id
              }">
                <img src="${imgUrl}" class="img-fluid list-roiser-image" alt="${
                p.name
              }" />
              </a>
              <span class="sale">${p.label || "New"}</span>
              <ul class="shop-list">
                <li><a href="javascript:void(0)" class="add-to-cart" data-name="${
                  p.name
                }" data-price="${p.price}" data-price_sale="${
                p.price_sale
              }" data-image="${
                p.image
              }"><i class="fa-regular fa-cart-shopping"></i></a></li>
                <li><a href="javascript:void(0)" class="add-to-wishlist" data-name="${
                  p.name
                }" data-image="${p.image}" data-store="default" data-price="${
                p.price
              }" data-price_sale="${p.price_sale}" data-sku="${
                p.sku || ""
              }" data-stockstatus="${
                p.stockstatus || "In Stock"
              }"><i class="fa-light fa-heart"></i></a></li>
                <li><a href="javascript:void(0)" class="view-lightbox" data-index="${absIdx}"><i class="fa-light fa-eye"></i></a></li>
              </ul>
            </div>
            <div class="shop-content">
              <span class="category">${p.category || ""}</span>
              <h3 class="title"><a href="${safeHref}" class="product-link" data-slug="${slug}" data-id="${
                p.id
              }">${p.name}</a></h3>
              <p>${p.description || ""}</p>
              <div class="review-wrap"><ul class="review">${stars}</ul><span>(${
                p.reviews || 0
              } Reviews)</span></div>
              <span class="price">${
                p.price_sale
                  ? `<span class="offer">${p.price_sale}</span>${p.price}`
                  : p.price
              }</span>
            </div>
          </div>`;
            }
          });

          // Attach event handlers
          document
            .querySelectorAll(".add-to-cart")
            .forEach((btn) => btn.addEventListener("click", cartHandler));
          document
            .querySelectorAll(".add-to-wishlist")
            .forEach((btn) => btn.addEventListener("click", wishlistHandler));
          document
            .querySelectorAll(".view-lightbox")
            .forEach((btn) => btn.addEventListener("click", openLightbox));

          // Product link click → save SLUG + redirect
          document.querySelectorAll(".product-link").forEach((link) => {
            link.addEventListener("click", (e) => {
              e.preventDefault();
              const productSlug =
                link.getAttribute("data-slug") ||
                link.getAttribute("href")?.split("/").pop();
              if (productSlug) {
                localStorage.setItem("selectedProductSlug", productSlug);
                // navigate to pretty URL
                window.location.href = `/shop-details/${encodeURIComponent(
                  productSlug
                )}`;
              } else if (link.href) {
                // fallback navigation
                window.location.href = link.href;
              }
            });
          });
        }

        function renderPagination() {
          if (!paginationEl) return;
          paginationEl.innerHTML = "";
          const totalPages = Math.ceil(allProducts.length / PER_PAGE);
          const pagesInGroup = 3;
          const endPage = Math.min(
            pageGroupStart + pagesInGroup - 1,
            totalPages
          );
          if (pageGroupStart > 1)
            paginationEl.innerHTML += `<li><a href="#"><i class="fa fa-angle-left"></i></a></li>`;
          for (let i = pageGroupStart; i <= endPage; i++) {
            paginationEl.innerHTML += `<li><a href="#" class="${
              i === currentPage ? "active" : ""
            }">${i}</a></li>`;
          }
          if (endPage < totalPages)
            paginationEl.innerHTML += `<li><a href="#"><i class="fa fa-angle-right"></i></a></li>`;
          paginationEl.querySelectorAll("li a").forEach((a) =>
            a.addEventListener("click", (e) => {
              e.preventDefault();
              const txt = a.textContent.trim();
              if (txt === "‹" || txt === "«") {
                pageGroupStart = Math.max(1, pageGroupStart - pagesInGroup);
                // no-op to keep currentPage intact
              } else if (txt === "›" || txt === "»") {
                pageGroupStart += pagesInGroup;
                currentPage = pageGroupStart;
              } else currentPage = Number(txt);
              renderProducts(currentPage);
              renderPagination();
              window.scrollTo({ top: 0, behavior: "smooth" });
            })
          );
        }

        function applyFilters() {
          const selBrands = Array.from(
            document.querySelectorAll("#brand-filter-list input:checked")
          ).map((cb) => cb.value);
          const selCats = Array.from(
            document.querySelectorAll("#category-filter-list input:checked")
          ).map((cb) => cb.value);
          const maxPrice =
            priceInput && priceInput.value
              ? Number(priceInput.value)
              : Infinity;
          const selSizeEl = document.querySelector(
            ".radion-btn-area input:checked"
          );
          const selSize = selSizeEl
            ? selSizeEl.nextElementSibling.textContent.trim()
            : null;
          if (
            !selBrands.length &&
            !selCats.length &&
            maxPrice === Infinity &&
            !selSize
          ) {
            return loadProducts(masterProducts);
          }
          let filtered = masterProducts.filter((p) => {
            if (selBrands.length && !selBrands.includes(p.brand)) return false;
            if (selCats.length) {
              const pcs = (p.categories || "").split(",").map((s) => s.trim());
              if (!selCats.some((c) => pcs.includes(c))) return false;
            }
            const priceVal =
              parseFloat((p.price || "").replace(/[^0-9.]/g, "")) || 0;
            if (priceVal > maxPrice) return false;
            if (selSize && !(p.attribute || "").includes(`Size:${selSize}`))
              return false;
            return true;
          });
          switch (currentSort) {
            case "can":
              filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
              break;
            case "vdt":
              filtered.sort((a, b) => a.name.localeCompare(b.name));
              break;
            case "uk":
              filtered.sort(
                (a, b) =>
                  parseFloat(a.price.replace(/[^0-9.]/g, "")) -
                  parseFloat(b.price.replace(/[^0-9.]/g, ""))
              );
              break;
            case "dk":
              filtered.sort((a, b) => b.name.localeCompare(a.name));
              break;
            case "dl":
              filtered.sort(
                (a, b) =>
                  parseFloat(b.price_sale.replace(/[^0-9.]/g, "")) -
                  parseFloat(a.price_sale.replace(/[^0-9.]/g, ""))
              );
              break;
          }
          loadProducts(filtered);
        }

        function loadLatestSidebar() {
          const latestContainer = document.getElementById("latest-products");
          fetch(apiEndpoint)
            .then((res) => res.json())
            .then((products) => {
              const latest = products
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 3);
              if (!latestContainer) return;
              latestContainer.innerHTML = latest
                .map((p) => {
                  const stars =
                    '<li><i class="fa-solid fa-star"></i></li>'.repeat(
                      p.rating || 5
                    );
                  const slug =
                    p.slug && p.slug.trim() ? p.slug.trim() : slugify(p.name);
                  const safeHref = `/shop-details/${encodeURIComponent(slug)}`;
                  const firstImg =
                    (p.image || "")
                      .split(",")
                      .map((s) => s.trim())
                      .filter(Boolean)[0] || "";
                  const imgUrl = firstImg ? `/api/${firstImg}` : imageBaseUrl;
                  return `<div class="sidebar-item">
              <div class="item-img">
                <a href="${safeHref}" class="product-link" data-slug="${slug}" data-id="${
                    p.id
                  }">
                  <img src="${imgUrl}" class="img-fluid border rounded" alt="${
                    p.name
                  }"/>
                </a>
              </div>
              <div class="content">
              <h4 class="title"><a href="${safeHref}" class="product-link" data-slug="${slug}" data-id="${
                    p.id
                  }">${p.name}</a></h4>
                <span class="price"><span class="offer">${
                  p.price_sale || ""
                }</span>${p.price || ""}</span>
              </div>
            </div>`;
                })
                .join("");

              // Sidebar product click
              latestContainer
                .querySelectorAll(".product-link")
                .forEach((link) => {
                  link.addEventListener("click", (e) => {
                    e.preventDefault();
                    const productSlug =
                      link.getAttribute("data-slug") ||
                      link.getAttribute("href")?.split("/").pop();
                    if (productSlug) {
                      localStorage.setItem("selectedProductSlug", productSlug);
                      window.location.href = `/shop-details/${encodeURIComponent(
                        productSlug
                      )}`;
                    } else if (link.href) {
                      window.location.href = link.href;
                    }
                  });
                });
            })
            .catch((err) => {
              console.error(err);
              if (latestContainer)
                latestContainer.innerHTML =
                  "<p class='text-danger'>Unable to load products</p>";
            });
        }

        function showBanner(msg, type = "success") {
          const b = document.createElement("div");
          b.className = `banner ${type}`;
          b.textContent = msg;
          Object.assign(b.style, {
            position: "fixed",
            top: "10px",
            left: "50%",
            transform: "translateX(-50%)",
            padding: "10px 20px",
            background: type === "success" ? "#4caf50" : "#f44336",
            color: "#fff",
            borderRadius: "4px",
            zIndex: 9999,
            boxShadow: "0 2px 6px rgba(0,0,0,0.3)",
          });
          document.body.appendChild(b);
          setTimeout(() => b.remove(), 3000);
        }

        const cleanPrice = (str = "") => str.replace(/[^0-9.]/g, "");

        function cartHandler(e) {
          e.preventDefault();
          const t = e.currentTarget;
          const user_id = localStorage.getItem("user_id");
          if (!user_id) return showBanner("Please log in first", "error");

          fetch("/api/addcart", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              name: t.dataset.name,
              price: cleanPrice(t.dataset.price),
              price_sale: cleanPrice(t.dataset.price_sale),
              image: t.dataset.image,
              user_id,
              store: t.dataset.store || "default",
            }),
          })
            .then((r) => {
              if (!r.ok) throw Error();
              return r.text();
            })
            .then((msg) => {
              t.innerHTML = '<i class="fa-solid fa-check"></i>';
              showBanner("Product added to cart!", "success");
            })
            .catch(() => showBanner("Failed to add to cart", "error"));
        }

        function wishlistHandler(e) {
          e.preventDefault();
          const t = e.currentTarget;
          const user_id = localStorage.getItem("user_id");
          if (!user_id) return showBanner("Please log in first", "error");

          fetch("/api/wishlistpost", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              user_id,
              product_name: t.dataset.name,
              image: t.dataset.image,
              store: t.dataset.store || "default",
              price: cleanPrice(t.dataset.price),
              price_sale: cleanPrice(t.dataset.price_sale),
              sku: t.dataset.sku,
              stockstatus: t.dataset.stockstatus,
            }),
          })
            .then((r) => {
              if (!r.ok) throw Error();
              return r.text();
            })
            .then((msg) => {
              t.innerHTML = '<i class="fa-solid fa-check"></i>';
              showBanner("Added to wishlist!", "success");
            })
            .catch(() => showBanner("Failed to add to wishlist", "error"));
        }

        function openLightbox(e) {
          e.preventDefault();
          const idx = parseInt(e.currentTarget.dataset.index, 10);
          if (isNaN(idx)) return;
          currentImages = productMainImages.slice();
          currentIndex = idx;
          updateLightbox();
          if (imageLightbox) imageLightbox.style.display = "flex";
        }

        function updateLightbox() {
          if (!currentImages.length) return;
          const img = currentImages[currentIndex] || "";
          lightboxImg.src = img ? `/api/${img}` : imageBaseUrl;
          counterEl.textContent = `${currentIndex + 1} of ${
            currentImages.length
          }`;
        }

        if (btnPrev) {
          btnPrev.addEventListener("click", () => {
            if (!currentImages.length) return;
            currentIndex =
              (currentIndex - 1 + currentImages.length) % currentImages.length;
            updateLightbox();
          });
        }

        if (btnNext) {
          btnNext.addEventListener("click", () => {
            if (!currentImages.length) return;
            currentIndex = (currentIndex + 1) % currentImages.length;
            updateLightbox();
          });
        }

        if (btnClose) {
          btnClose.addEventListener("click", () => {
            if (imageLightbox) imageLightbox.style.display = "none";
            currentImages = [];
            currentIndex = 0;
          });
        }
      });
    </script>

    <div
      id="image-lightbox"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        justify-content: center;
        align-items: center;
        z-index: 9999;
        flex-direction: column;
      "
    >
      <div
        style="
          position: relative;
          display: flex;
          align-items: center;
          justify-content: center;
          width: 100%;
          height: 100%;
        "
      >
        <button
          id="lightbox-prev"
          style="
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 22px;
            color: white;
            background: none;
            border: none;
            cursor: pointer;
          "
        >
          <i class="fas fa-play" style="transform: rotate(180deg)"></i>
        </button>

        <div style="position: relative; display: inline-block">
          <img
            id="lightbox-image"
            src=""
            alt="Product"
            style="
              width: 336px;
              height: 400px;
              object-fit: contain;
              border-radius: 4px;
            "
          />

          <div
            id="lightbox-counter"
            style="
              position: absolute;
              bottom: 0px;
              right: -2px;
              color: #fff;
              padding: 4px 8px;
              border-radius: 12px;
              font-size: 14px;
            "
          >
            1 of 0
          </div>

          <button
            id="lightbox-close"
            style="
              position: absolute;
              top: 0;
              right: -8px;
              font-size: 36px;
              color: white;
              border: none;
              border-radius: 50%;
              width: 32px;
              height: 32px;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              padding: 0;
              z-index: 10;
            "
          >
            ×
          </button>
        </div>

        <button
          id="lightbox-next"
          style="
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 22px;
            color: white;
            background: none;
            border: none;
            cursor: pointer;
          "
        >
          <i class="fas fa-play"></i>
        </button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const userId = localStorage.getItem("user_id");

        function updateCartIcon() {
          if (!userId) return;

          fetch(`/api/allcartdata?user_id=${userId}`)
            .then((res) => res.json())
            .then((data) => {
              let totalItems = 0;
              let totalAmount = 0;
              const seen = new Set();

              if (Array.isArray(data) && data.length > 0) {
                data.forEach((item) => {
                  const name = item.name;
                  if (seen.has(name)) {
                    return;
                  }
                  seen.add(name);

                  const quantity = parseInt(item.quantity || 1, 10);
                  const price = parseFloat(
                    (item.price || "").replace("$", "") || 0
                  );

                  totalItems += quantity;
                  totalAmount += quantity * price;
                });
              }

              document.querySelector(".icon span").innerText = totalItems;
              document.querySelector(
                ".content h5.number"
              ).innerText = `$${totalAmount.toFixed(2)}`;
            })
            .catch((err) => {
              console.error("Error updating cart info:", err);
            });
        }

        function stripTags(html) {
          const tmp = document.createElement("div");
          tmp.innerHTML = html;
          return tmp.textContent || tmp.innerText || "";
        }

        function updateAnnouncements() {
          fetch("/api/getannounce")
            .then((res) => res.json())
            .then((data) => {
              if (!data || !data.length) return;

              const today = new Date();
              const validAnnouncements = data.filter(
                (item) =>
                  item.active === "yes" && new Date(item.end_date) >= today
              );
              if (!validAnnouncements.length) return;

              const limitWords = (text, limit = 6) => {
                const words = text.trim().split(/\s+/);
                return (
                  words.slice(0, limit).join(" ") +
                  (words.length > limit ? "..." : "")
                );
              };

              const messages = validAnnouncements.map((item) =>
                limitWords(stripTags(item.content))
              );

              const announcer = document.getElementById("announcement-text");
              let index = 0;

              const rotate = () => {
                announcer.style.transform = "translateY(-100%)";
                setTimeout(() => {
                  announcer.textContent = messages[index];
                  announcer.style.transform = "translateY(0)";
                  index = (index + 1) % messages.length;
                }, 300);
              };

              announcer.textContent = messages[index];
              index++;
              setInterval(rotate, 3000);
            })
            .catch((err) => {
              console.error("Error fetching announcement:", err);
            });
        }

        updateCartIcon();
        setInterval(updateCartIcon, 1000);
        updateAnnouncements();
      });

      function getUserId() {
        return localStorage.getItem("user_id") || null;
      }
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let selectedCurrency = "vdt";
        const currencyRates = {
          vdt: { symbol: "$", rate: 1 },
          can: { symbol: "₹", rate: 83 },
          uk: { symbol: "৳", rate: 108 },
        };

        document
          .querySelectorAll(".nice-select.country .option")
          .forEach((opt) => {
            opt.addEventListener("click", () => {
              const code = opt.dataset.value;
              if (currencyRates[code]) {
                selectedCurrency = code;
                document.querySelector(
                  ".nice-select.country .current"
                ).textContent = opt.textContent;
              }
            });
          });

        function formatPrice(raw) {
          const n = parseFloat(raw.replace(/[^0-9.]/g, "")) || 0;
          const { symbol, rate } = currencyRates[selectedCurrency];
          return symbol + (n * rate).toFixed(2);
        }

        const wrapper = document.querySelector(".category-form-wrap");
        wrapper.style.position = "relative";

        const resultBox = document.createElement("div");
        resultBox.classList.add("search-result-dropdown");
        Object.assign(resultBox.style, {
          position: "absolute",
          top: "100%",
          left: "0%",
          width: "100%",
          background: "#fff",
          border: "1px solid #ddd",
          zIndex: "1000",
          maxHeight: "300px",
          overflowY: "auto",
          display: "none",
        });
        wrapper.appendChild(resultBox);

        const searchInput = wrapper.querySelector('input[name="search"]');
        let timeout;

        searchInput.addEventListener("input", () => {
          const q = searchInput.value.trim();
          clearTimeout(timeout);

          if (q.length < 2) {
            resultBox.style.display = "none";
            resultBox.innerHTML = "";
            return;
          }

          timeout = setTimeout(() => {
            fetch("/api/productpagedata")
              .then((r) => r.json())
              .then((products) => {
                const matches = products
                  .filter((p) => p.name.toLowerCase().includes(q.toLowerCase()))
                  .slice(0, 5);

                if (!matches.length) {
                  resultBox.innerHTML = `<div style="padding:10px;color:#666">No matching products found at this time.</div>`;
                } else {
                  resultBox.innerHTML =
                    matches
                      .map((p) => {
                        const img = (p.image || "").split(",")[0].trim();
                        const mainPrice = formatPrice(p.price);
                        const salePrice = p.price_sale
                          ? `<strong class="text-dark me-2">${formatPrice(
                              p.price
                            )}</strong>
                              <s class="fw-bold text-danger">${formatPrice(
                                p.price_sale
                              )}</s>`
                          : `<strong class="fw-bold text-dark">${formatPrice(
                              p.price
                            )}</strong>`;

                        return `
                    <div
                      onclick="window.location.href='/shop'"
                      style="cursor:pointer;display:flex;align-items:center;padding:8px 10px;border-bottom:1px solid #eee;"
                    >
                      <img src="/api/uploads/${img}" alt="${p.name}"
                          style="width:40px;height:40px;object-fit:cover;margin-right:10px;">
                      <div>
                        <div class="fw-bold text-dark">${p.name}</div>
                        <div style="font-size:0.85em;color:#999;">
                          ${salePrice}
                        </div>
                      </div>
                    </div>
                  `;
                      })
                      .join("") +
                    `
                  <div onclick="window.location.href='/shop'"
                    style="padding:10px;text-align:center;color:#e74c3c;font-weight:600;cursor:pointer;"
                  >
                    Show all results
                  </div>
                `;
                }

                resultBox.style.display = "block";
              })
              .catch((err) => {
                console.error("Error fetching products:", err);
                resultBox.innerHTML = `<div style="padding:10px;color:red;">Error loading results.</div>`;
                resultBox.style.display = "block";
              });
          }, 300);
        });

        document.addEventListener("click", (e) => {
          if (!wrapper.contains(e.target)) {
            resultBox.style.display = "none";
          }
        });
      });
    </script>

    <footer class="footer-section bg-grey pt-60">
      <div class="container">
        <div class="footer-items">
          <div class="footer-item">
            <div class="icon">
              <img
                src="assets/img/icon/footer-1.png"
                alt="icon"
                loading="lazy"
              />
            </div>
            <div class="content">
              <h4 class="title">Free Shipping</h4>
              <span>Free shipping on orders over $65.00</span>
            </div>
          </div>
          <div class="footer-item">
            <div class="icon">
              <img
                src="assets/img/icon/footer-2.png"
                alt="icon"
                loading="lazy"
              />
            </div>
            <div class="content">
              <h4 class="title">Free Returns</h4>
              <span>30-days free return polic</span>
            </div>
          </div>
          <div class="footer-item">
            <div class="icon">
              <img
                src="assets/img/icon/footer-3.png"
                alt="icon"
                loading="lazy"
              />
            </div>
            <div class="content">
              <h4 class="title">Secured Payments</h4>
              <span>We accept all major credit card</span>
            </div>
          </div>
          <div class="footer-item item-2">
            <div class="icon">
              <img
                src="assets/img/icon/footer-4.png"
                alt="icon"
                loading="lazy"
              />
            </div>
            <div class="content">
              <h4 class="title">Customer Service</h4>
              <span>Top notch customer service</span>
            </div>
          </div>
        </div>
        <div class="row footer-widget-wrap pb-60">
          <div class="col-lg-3 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">About Store</h3>
              </div>
              <div class="footer-contact">
                <div class="icon">
                  <i class="fa-sharp fa-solid fa-phone-rotary"></i>
                </div>
                <div class="content">
                  <span>Have Question? Call Us 24/7</span>
                  <a href="tel:+25836922569">+258 3692 2569</a>
                </div>
              </div>
              <ul class="schedule-list">
                <li><span>Monday - Friday:</span>8:00am - 6:00pm</li>
                <li><span>Saturday:</span>8:00am - 6:00pm</li>
                <li><span>Sunday</span> Service Close</li>
              </ul>
            </div>
          </div>
          <div class="col-lg-2 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">Our Stores</h3>
              </div>
              <ul class="footer-list">
                <li><a href="contact.html">New York</a></li>
                <li><a href="contact.html">London SF</a></li>
                <li><a href="contact.html">Los Angele</a></li>
                <li><a href="contact.html">Chicago</a></li>
                <li><a href="contact.html">Las Vegas</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-2 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">Shop Categories</h3>
              </div>
              <ul class="footer-list">
                <li><a href="contact.html">New Arrivals</a></li>
                <li><a href="contact.html">Best Selling</a></li>
                <li><a href="contact.html">Vegetables</a></li>
                <li><a href="contact.html">Fresh Meat</a></li>
                <li><a href="contact.html">Fresh Seafood</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-2 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">Useful Links</h3>
              </div>
              <ul class="footer-list">
                <li><a href="contact.html">Privacy Policy</a></li>
                <li><a href="contact.html">Terms & Conditions</a></li>
                <li><a href="contact.html">Contact Us</a></li>
                <li><a href="contact.html">Latest News</a></li>
                <li><a href="contact.html">Our Sitemaps</a></li>
              </ul>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="footer-widget">
              <div class="widget-header">
                <h3 class="widget-title">Our Newsletter</h3>
              </div>
              <div class="news-form-wrap">
                <p class="mb-20">
                  Subscribe to the mailing list to receive updates one the new
                  arrivals and other discounts
                </p>
                <div class="footer-form mb-20">
                  <form action="#" class="rr-subscribe-form">
                    <input
                      class="form-control py-4"
                      type="email"
                      name="email"
                      placeholder="Email address"
                      required
                    />
                    <input
                      type="hidden"
                      name="action"
                      value="mailchimpsubscribe"
                    />
                    <button class="submit" type="submit">Subscribe</button>
                    <div class="clearfix"></div>
                  </form>
                </div>
                <p class="mb-0">
                  I would like to receive news and special offer
                </p>
              </div>
            </div>
          </div>

          <script>
            document.addEventListener("DOMContentLoaded", () => {
              const form = document.querySelector(".rr-subscribe-form");
              if (!form) return;

              function showBanner(msg, type = "success") {
                const b = document.createElement("div");
                b.className = `banner ${type}`;
                b.textContent = msg;
                Object.assign(b.style, {
                  position: "fixed",
                  top: "10px",
                  left: "50%",
                  transform: "translateX(-50%)",
                  padding: "10px 20px",
                  background: type === "success" ? "#4caf50" : "#f44336",
                  color: "#fff",
                  borderRadius: "4px",
                  zIndex: 9999,
                  boxShadow: "0 2px 6px rgba(0,0,0,0.3)",
                });
                document.body.appendChild(b);
                setTimeout(() => b.remove(), 3000);
              }

              form.addEventListener("submit", async (e) => {
                e.preventDefault();

                const input = form.querySelector('input[name="email"]');
                const email = input.value.trim();
                if (!email) {
                  showBanner("Please enter a valid email.", "error");
                  return;
                }

                try {
                  const res = await fetch("/api/newsletterpost", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email }),
                  });
                  const text = await res.text();

                  if (res.ok) {
                    showBanner("Subscribed successfully!", "success");
                    form.reset();
                  } else {
                    showBanner(text || "Subscription failed.", "error");
                  }
                } catch (err) {
                  console.error("Newsletter error:", err);
                  showBanner("Network error, please try again.", "error");
                }
              });
            });
          </script>
        </div>
      </div>

      <div class="copyright-area">
        <div class="container">
          <div class="row copyright-content">
            <div class="col-lg-6">
              <div class="footer-img-wrap">
                <span>Payment System:</span>
                <div class="footer-img">
                  <a
                    href="/"
                    aria-label="Go to homepage"
                    title="Go to homepage"
                  >
                    <img
                      src="https://avatars.mds.yandex.net/i?id=bec5b0beccb70346fc778cdb735d787bcd15343d-12937823-images-thumbs&n=13"
                      alt="img"
                      style="width: 264px; height: 24px"
                      loading="lazy"
                  /></a>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <p>
                Copyright & Design <span id="designYear">2025</span>
                <span>©Roiser</span>. All Right Reserved
              </p>
            </div>

            <script>
              document.addEventListener("DOMContentLoaded", () => {
                const yearSpan = document.getElementById("designYear");
                if (yearSpan) {
                  yearSpan.textContent = new Date().getFullYear();
                }
              });
            </script>
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        fetch("/api/get-font-settings")
          .then((res) => {
            if (!res.ok) throw new Error("Network error");
            return res.json();
          })
          .then((cfg) => {
            const s = document.createElement("style");
            s.type = "text/css";

            s.textContent = `
              body {
                font-family: ${cfg.font_family}, sans-serif !important;
                font-size: ${cfg.body_font_size}px !important;
              }
              h1 { font-size: ${cfg.h1_font_size}px !important; }
              h2 { font-size: ${cfg.h2_font_size}px !important; }
              h3 { font-size: ${cfg.h3_font_size}px !important; }
              h4 { font-size: ${cfg.h4_font_size}px !important; }
              h5 { font-size: ${cfg.h5_font_size}px !important; }
              h6 { font-size: ${cfg.h6_font_size}px !important; }
            `;
            document.head.appendChild(s);
          })
          .catch((err) => {
            console.error("Could not load font settings:", err);
          });
      });
    </script>

    <div id="scroll-percentage"><span id="scroll-percentage-value"></span></div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        fetch("/api/get-theme-logo")
          .then((res) => {
            if (!res.ok) throw new Error("Failed to load logo data");
            return res.json();
          })
          .then((cfg) => {
            const img = document.getElementById("site-logo");
            if (!img) return;
            if (cfg.logo_url) {
              img.src = `/api/${cfg.logo_url}`;
            }
            if (cfg.logo_height) {
              img.height = cfg.logo_height;
            }
          })
          .catch((err) => {
            console.error("Could not load theme logo:", err);
          });

        fetch("/api/themestylesdata")
          .then((res) => {
            if (!res.ok) throw new Error("Network error");
            return res.json();
          })
          .then((cfg) => {
            const topBg = cfg.headerBackgroundColor || "#ffffff";
            const topBar = document.querySelector(".top-bar");
            if (topBar) {
              topBar.style.setProperty("background-color", topBg, "important");
              topBar.querySelectorAll(
                "a, span, li, .nice-select .current, .nice-select .option"
              );
            }

            const midBg = cfg.headerMainColor || "#ffffff";
            const midTxt = cfg.headerMainTextColor || "#000000";
            const headerMid = document.querySelector(".header-middle");
            if (headerMid) {
              headerMid.style.setProperty(
                "background-color",
                midBg,
                "important"
              );
              headerMid
                .querySelectorAll(
                  "a, span, li, .contact-item-list .content span, " +
                    ".contact-item-list .content a, .contact-item-list .number, " +
                    ".rr-primary-btn, .nice-select .current, .nice-select .option"
                )
                .forEach((el) => {
                  el.style.setProperty("color", midTxt, "important");
                });
            }

            const scrollPercentage =
              document.getElementById("scroll-percentage");
            if (scrollPercentage) {
              if (cfg.backToTopButton === "no") {
                scrollPercentage.style.display = "none";
              } else {
                scrollPercentage.style.display = "block";
              }
            }
          })
          .catch((err) => {
            console.error("Could not load theme styles:", err);
          });
      });
    </script>

    <script src="assets/js/vendor/jquary-3.6.0.min.js"></script>
    <script src="assets/js/vendor/bootstrap-bundle.js"></script>
    <script src="assets/js/vendor/imagesloaded-pkgd.js"></script>
    <script src="assets/js/vendor/waypoints.min.js"></script>
    <script src="assets/js/vendor/venobox.min.js"></script>
    <script src="assets/js/vendor/odometer.min.js"></script>
    <script src="assets/js/vendor/meanmenu.js"></script>
    <script src="assets/js/vendor/smooth-scroll.js"></script>
    <script src="assets/js/vendor/jquery.isotope.js"></script>
    <script src="assets/js/vendor/countdown.js"></script>
    <script src="assets/js/vendor/wow.min.js"></script>
    <script src="assets/js/vendor/swiper.min.js"></script>
    <script src="assets/js/vendor/nice-select.js"></script>
    <script src="assets/js/ajax-form.js"></script>
    <script src="assets/js/contact.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
  </body>
</html>
